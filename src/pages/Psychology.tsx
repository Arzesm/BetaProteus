import { useState, useEffect, useRef } from "react";
import { useNavigate } from "react-router-dom";
import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from "@/components/ui/accordion";
import { Card } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { Badge } from "@/components/ui/badge";
import { Layers, Activity, Crown, Brain } from "lucide-react";
import { MBTITest } from "@/components/psychology/MBTITest";
import StressTest from "@/components/psychology/StressTest";
import { BigFiveTest } from "@/components/psychology/BigFiveTest";
import { ArchetypeTest } from "@/components/psychology/ArchetypeTest";
import { Button } from "@/components/ui/button";
import { motion } from "framer-motion";
import { pageAnimation, cardAnimation, cardHover } from "@/lib/animations";
import html2canvas from "html2canvas";
import { BigFiveResult } from "@/data/bigFiveTest";
import { ArchetypeResult } from "@/data/archetypeTest";
import { StressResult } from "@/data/stressTest";

type MbtiScores = { E: number; I: number; S: number; N: number; T: number; F: number; J: number; P: number };

type TestComponent = React.ComponentType<{
  onComplete: (result: any) => void;
}>;

const PsychologyPage = () => {
  const navigate = useNavigate();
  const [activeTest, setActiveTest] = useState<string | null>(null);
  const [testResults, setTestResults] = useState<Record<string, string | { type: string; scores: MbtiScores } | BigFiveResult[] | ArchetypeResult[] | StressResult>>(() => {
    try {
      const savedResults = localStorage.getItem('psychologyTestResults');
      return savedResults ? JSON.parse(savedResults) : {};
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤ –∏–∑ localStorage", error);
      return {};
    }
  });

  // –•—É–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤ - –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –Ω–∞—á–∞–ª–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  const [expandedArchetypes, setExpandedArchetypes] = useState<string[]>([]);
  
  const toggleArchetype = (archetypeId: string) => {
    setExpandedArchetypes(prev => 
      prev.includes(archetypeId) 
        ? prev.filter(id => id !== archetypeId)
        : [...prev, archetypeId]
    );
  };

  const resetArchetypeState = () => {
    setExpandedArchetypes([]);
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø–∏—Å–∞–Ω–∏–π Big Five —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π
  const getBigFiveHighLevelDescription = (factor: string) => {
    switch (factor) {
      case 'openness':
        return '–í—ã –æ—Ç–∫—Ä—ã—Ç—ã –Ω–æ–≤–æ–º—É, –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã. –í–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è –∏–∑—É—á–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∏–¥–µ–∏, –∫—É–ª—å—Ç—É—Ä—ã, –Ω–∞—É–∫–∏ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ. –í—ã –ª–µ–≥–∫–æ —Ñ–∞–Ω—Ç–∞–∑–∏—Ä—É–µ—Ç–µ, —Ü–µ–Ω–∏—Ç–µ –∫—Ä–∞—Å–æ—Ç—É –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã. –° –í–∞–º–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –æ–±—Å—É–∂–¥–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã ‚Äî —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ, –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∏–ª–∏ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ. –í—ã –≥–∏–±–∫–∏ –≤ –º—ã—à–ª–µ–Ω–∏–∏ –∏ —É–º–µ–µ—Ç–µ –Ω–∞—Ö–æ–¥–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.';
      case 'conscientiousness':
        return '–í—ã –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∏—Ä–æ–≤–∞–Ω—ã –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã. –í—ã —É–º–µ–µ—Ç–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∏ –¥–æ–≤–æ–¥–∏—Ç—å –¥–µ–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞, —Å–µ—Ä—å—ë–∑–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—è–º –∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º. –í–∞—Å –º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å —á–µ–ª–æ–≤–µ–∫–æ–º –Ω–∞–¥—ë–∂–Ω—ã–º: –æ–∫—Ä—É–∂–∞—é—â–∏–µ –∑–Ω–∞—é—Ç, —á—Ç–æ –í—ã –¥–µ—Ä–∂–∏—Ç–µ —Å–ª–æ–≤–æ –∏ —É–º–µ–µ—Ç–µ —É–ø–æ—Ä–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å.';
      case 'extraversion':
        return '–í—ã —ç–Ω–µ—Ä–≥–∏—á–Ω—ã, –æ–±—â–∏—Ç–µ–ª—å–Ω—ã –∏ –ª—é–±–∏—Ç–µ –±—ã—Ç—å —Å—Ä–µ–¥–∏ –ª—é–¥–µ–π. –í–∞–º –ª–µ–≥–∫–æ –∑–∞–≤–æ–¥–∏—Ç—å –Ω–æ–≤—ã–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞, –±—Ä–∞—Ç—å –Ω–∞ —Å–µ–±—è –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –∏ –±—ã—Ç—å –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è. –í—ã –ª—é–±–∏—Ç–µ —à—É–º–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏, –∞–∫—Ç–∏–≤–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –ø—Ä–∏–ª–∏–≤ —Å–∏–ª –≤ –æ–±—â–µ–Ω–∏–∏. –í–∞—Å –º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å –∂–∏–∑–Ω–µ—Ä–∞–¥–æ—Å—Ç–Ω—ã–º –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º.';
      case 'agreeableness':
        return '–í—ã –¥–æ–≤–µ—Ä—è–µ—Ç–µ –ª—é–¥—è–º, —É–º–µ–µ—Ç–µ —Å–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –∏ —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã–º –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º. –í–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è –ø–æ–º–æ–≥–∞—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã. –í—ã –º—è–≥–∫–∏, –æ—Ç–∑—ã–≤—á–∏–≤—ã –∏ —Å—Ç–∞—Ä–∞–µ—Ç–µ—Å—å –∏–∑–±–µ–≥–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤. –õ—é–¥–∏ —Ü–µ–Ω—è—Ç –≤ –í–∞—Å –¥–æ–±—Ä–æ—Ç—É, —á–µ—Å—Ç–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å.';
      case 'neuroticism':
        return '–í—ã —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã –∏ —Å–∫–ª–æ–Ω–Ω—ã –∫ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏. –í–∞–º –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç—Ä—É–¥–Ω–æ —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º, –∫—Ä–∏—Ç–∏–∫–æ–π –∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å—é. –í–∞—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–æ–≥–¥–∞ –±—ã—Å—Ç—Ä–æ –º–µ–Ω—è–µ—Ç—Å—è, –∏ –í—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å –¥–∞–∂–µ –±–µ–∑ —Å–µ—Ä—å—ë–∑–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω. –í–º–µ—Å—Ç–µ —Å —Ç–µ–º —ç—Ç–æ –¥–µ–ª–∞–µ—Ç –í–∞—Å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–º –∫ —Å–µ–±–µ –∏ —Å–≤–æ–∏–º —á—É–≤—Å—Ç–≤–∞–º.';
      default:
        return '';
    }
  };

  const getBigFiveMediumLevelDescription = (factor: string) => {
    switch (factor) {
      case 'openness':
        return '–í—ã —É–º–µ–µ—Ç–µ —Å–æ—á–µ—Ç–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å –∫ –Ω–æ–≤–æ–º—É —Å –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å—é. –ò–Ω–æ–≥–¥–∞ –í—ã —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º –ø—Ä–æ–±—É–µ—Ç–µ –Ω–æ–≤—ã–µ –∏–¥–µ–∏ –∏–ª–∏ —Ñ–æ—Ä–º—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –Ω–æ –Ω–µ —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º. –í–∞–º –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ –∏ –≤ –º–∏—Ä–µ —Ç—Ä–∞–¥–∏—Ü–∏–π, –∏ –≤ –º–∏—Ä–µ –Ω–æ–≤—ã—Ö –æ—Ç–∫—Ä—ã—Ç–∏–π. –ú–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –í—ã –æ—Ç–∫—Ä—ã—Ç—ã –∫ –ø–µ—Ä–µ–º–µ–Ω–∞–º, –Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ –Ω–∏–º –∏–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω–æ.';
      case 'conscientiousness':
        return '–í—ã —Å—Ç–∞—Ä–∞–µ—Ç–µ—Å—å –±—ã—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã–º, –Ω–æ –∏–Ω–æ–≥–¥–∞ –¥–æ–ø—É—Å–∫–∞–µ—Ç–µ –≥–∏–±–∫–æ—Å—Ç—å –∏–ª–∏ —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å. –í–∞–º –≤–∞–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å –¥–µ–ª–∞, –Ω–æ –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è –∏–ª–∏ –ø–æ–º–µ–Ω—è—Ç—å –ø–ª–∞–Ω—ã. –í—ã —Å–æ–≤–º–µ—â–∞–µ—Ç–µ –≤ —Å–µ–±–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É –∏ —Å–≤–æ–±–æ–¥—É, —É–º–µ–µ—Ç–µ –±—ã—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º, –Ω–æ –Ω–µ —á—Ä–µ–∑–º–µ—Ä–Ω–æ –∂—ë—Å—Ç–∫–∏–º.';
      case 'extraversion':
        return '–í—ã –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è –∏ —Å—Ä–µ–¥–∏ –ª—é–¥–µ–π, –∏ –Ω–∞–µ–¥–∏–Ω–µ —Å —Å–æ–±–æ–π. –ò–Ω–æ–≥–¥–∞ –í–∞–º —Ö–æ—á–µ—Ç—Å—è –±—ã—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–º –∏ –æ–±—â–∏—Ç–µ–ª—å–Ω—ã–º, –∞ –∏–Ω–æ–≥–¥–∞ ‚Äî —Å–ø–æ–∫–æ–π–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –≤—Ä–µ–º—è –≤ —Ç–∏—à–∏–Ω–µ. –í—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é –∏ —É–º–µ–µ—Ç–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –∏ —É–µ–¥–∏–Ω–µ–Ω–∏–µ–º.';
      case 'agreeableness':
        return '–í—ã —É–º–µ–µ—Ç–µ –±—ã—Ç—å –¥–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–º, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –∏–¥—ë—Ç–µ –Ω–∞ —É—Å—Ç—É–ø–∫–∏. –ò–Ω–æ–≥–¥–∞ –í—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –ø–æ–º–æ—á—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å, –∞ –∏–Ω–æ–≥–¥–∞ ‚Äî –Ω–∞—Å—Ç–æ—è—Ç—å –Ω–∞ —Å–≤–æ—ë–º. –í—ã —Å—Ç–∞—Ä–∞–µ—Ç–µ—Å—å –±—ã—Ç—å —á–µ—Å—Ç–Ω—ã–º –∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–º, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º —Å–ø–æ—Å–æ–±–Ω—ã –∑–∞—â–∏—â–∞—Ç—å —Å–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏ –≤—ã—Ä–∞–∂–∞—Ç—å –∫—Ä–∏—Ç–∏–∫—É.';
      case 'neuroticism':
        return '–í—ã –∏–Ω–æ–≥–¥–∞ –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç–µ –∏ —Ç—Ä–µ–≤–æ–∂–∏—Ç–µ—Å—å, –Ω–æ —É–º–µ–µ—Ç–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ. –í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —ç–º–æ—Ü–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —è—Ä–∫–æ, –Ω–æ –≤ —Ü–µ–ª–æ–º —Å–ø–æ—Å–æ–±–Ω—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏—Ö. –í —Å—Ç—Ä–µ—Å—Å–æ–≤—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø—ã—Ç—ã–≤–∞—Ç—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, –Ω–æ –Ω–µ —Ç–µ—Ä—è–µ—Ç–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å –∑–∞–¥–∞—á–∞–º–∏.';
      default:
        return '';
    }
  };

  const getBigFiveLowLevelDescription = (factor: string) => {
    switch (factor) {
      case 'openness':
        return '–í—ã –ø—Ä–∞–∫—Ç–∏—á–Ω—ã, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã –∏ —Ü–µ–Ω–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è. –í–∞–º –∫–æ–º—Ñ–æ—Ä—Ç–Ω–µ–µ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –∑–Ω–∞–∫–æ–º–æ–≥–æ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ –∂–∏–∑–Ω–∏. –í–∞–º –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–Ω–µ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã –∏—Å–∫—É—Å—Å—Ç–≤–æ, —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è –∏–ª–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã, –∑–∞—Ç–æ –í—ã —É–º–µ–µ—Ç–µ –≤–∏–¥–µ—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É –∏ –æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ –Ω–∞–¥—ë–∂–Ω—ã–µ –º–µ—Ç–æ–¥—ã. –í—ã —Ç–≤—ë—Ä–¥–æ —Å—Ç–æ–∏—Ç–µ –Ω–∞ –∑–µ–º–ª–µ –∏ –∏–∑–±–µ–≥–∞–µ—Ç–µ –ª–∏—à–Ω–∏—Ö —Ä–∏—Å–∫–æ–≤.';
      case 'conscientiousness':
        return '–í—ã —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ã –∏ –≥–∏–±–∫–∏, —á–∞—Å—Ç–æ –¥–µ–π—Å—Ç–≤—É–µ—Ç–µ –ø–æ —Å–∏—Ç—É–∞—Ü–∏–∏. –í–∞–º –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç—Ä—É–¥–Ω–æ —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥–æ–≤–∞—Ç—å –ø–ª–∞–Ω–∞–º –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∞—Ç—å –∑–∞–¥–∞—á–∏ –≤–æ–≤—Ä–µ–º—è. –ò–Ω–æ–≥–¥–∞ –í—ã –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç–µ –¥–µ–ª–∞ –Ω–∞ –ø–æ—Ç–æ–º –∏–ª–∏ –±—ã—Å—Ç—Ä–æ —Ç–µ—Ä—è–µ—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å –∫ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–º –∑–∞–¥–∞—á–∞–º. –ü—Ä–∏ —ç—Ç–æ–º –í–∞—à–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å ‚Äî —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –±—ã—Ç—å —Ç–≤–æ—Ä—á–µ—Å–∫–∏–º, –ª—ë–≥–∫–∏–º –Ω–∞ –ø–æ–¥—ä—ë–º –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—É—Ç–∏.';
      case 'extraversion':
        return '–í—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ —Å–ø–æ–∫–æ–π–Ω—É—é –æ–±—Å—Ç–∞–Ω–æ–≤–∫—É –∏ –≥–ª—É–±–æ–∫–∏–µ, –∞ –Ω–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã. –í–∞–º –∫–æ–º—Ñ–æ—Ä—Ç–Ω–µ–µ –Ω–∞–µ–¥–∏–Ω–µ —Å —Å–æ–±–æ–π –∏–ª–∏ —Å –±–ª–∏–∑–∫–∏–º–∏ –ª—é–¥—å–º–∏. –í—ã –Ω–µ –ª—é–±–∏—Ç–µ –±—ã—Ç—å –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è, –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ —Å–ª—É—à–∞—Ç—å –±–æ–ª—å—à–µ, —á–µ–º –≥–æ–≤–æ—Ä–∏—Ç—å. –í–∞—Å –æ—Ç–ª–∏—á–∞–µ—Ç –≤–¥—É–º—á–∏–≤–æ—Å—Ç—å, –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —É–º–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º –º–∏—Ä–µ.';
      case 'agreeableness':
        return '–í—ã –±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã. –í–∞–º —Å–≤–æ–π—Å—Ç–≤–µ–Ω–Ω–∞ –ø—Ä—è–º–æ—Ç–∞, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –∏ —Å–∫–µ–ø—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –¥—Ä—É–≥–∏–º. –í—ã –æ—Ç–∫—Ä—ã—Ç–æ –æ—Ç—Å—Ç–∞–∏–≤–∞–µ—Ç–µ —Å–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏ –Ω–µ –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –∏–¥—Ç–∏ –Ω–∞ —É—Å—Ç—É–ø–∫–∏. –í–∞—Å –º–æ–∂–Ω–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å –∫–∞–∫ —Å—Ç—Ä–æ–≥–æ–≥–æ, –Ω–æ —á–µ—Å—Ç–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –±–æ–∏—Ç—Å—è –≥–æ–≤–æ—Ä–∏—Ç—å –ø—Ä–∞–≤–¥—É.';
      case 'neuroticism':
        return '–í—ã —Å–ø–æ–∫–æ–π–Ω—ã, —É–≤–µ—Ä–µ–Ω—ã –≤ —Å–µ–±–µ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —É—Å—Ç–æ–π—á–∏–≤—ã. –î–∞–∂–µ –≤ —Å–ª–æ–∂–Ω—ã—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞—Ö –í—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ —Ö–ª–∞–¥–Ω–æ–∫—Ä–æ–≤–∏–µ –∏ –Ω–µ –ø–æ–¥–¥–∞—ë—Ç–µ—Å—å –ø–∞–Ω–∏–∫–µ. –í–∞—Å —Ç—Ä—É–¥–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –∏–∑ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è, –í—ã —É–º–µ–µ—Ç–µ —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –±—É–¥—É—â–µ–µ —Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é.';
      default:
        return '';
    }
  };

  useEffect(() => {
    try {
      localStorage.setItem('psychologyTestResults', JSON.stringify(testResults));
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤ –≤ localStorage", error);
    }
  }, [testResults]);

  const tests: Array<{
    id: string;
    title: string;
    description: string;
    longDescription: string;
    icon: React.ComponentType<any>;
    component: TestComponent;
    color: string;
  }> = [
    {
      id: 'mbti',
      title: '–¢–µ—Å—Ç MBTI',
      description: '–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏',
      longDescription: 'MBTI ‚Äî –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–∏–ø–∞ –ú–∞–π–µ—Ä—Å‚Äì–ë—Ä–∏–≥–≥—Å —Å 92 –≤–æ–ø—Ä–æ—Å–∞–º–∏. –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –≤—ã —á–µ—Ä–ø–∞–µ—Ç–µ —ç–Ω–µ—Ä–≥–∏—é (E/I), –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (S/N), –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ —Ä–µ—à–µ–Ω–∏—è (T/F) –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç–µ –∂–∏–∑–Ω—å (J/P). –¢–µ—Å—Ç –Ω–µ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç ¬´—Ö–æ—Ä–æ—à–æ/–ø–ª–æ—Ö–æ¬ª, –∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã.',
      icon: Layers,
      component: MBTITest,
      color: 'text-purple-500'
    },
    {
      id: 'big-five',
      title: '–¢–µ—Å—Ç Big Five (112 –≤–æ–ø—Ä–æ—Å–æ–≤)',
      description: '–ü—è—Ç–∏—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –º–æ–¥–µ–ª—å –ª–∏—á–Ω–æ—Å—Ç–∏',
      longDescription: 'Big Five –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –ø—è—Ç—å —É—Å—Ç–æ–π—á–∏–≤—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤: –û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –æ–ø—ã—Ç—É, –î–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ—Å—Ç—å, –≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—é, –î–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ù–µ–π—Ä–æ—Ç–∏–∑–º. –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –∏–∑ 112 –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–µ–π –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–º–∏ —á–µ—Ä—Ç–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–∫—Ç–æ—Ä–∞.',
      icon: Brain,
      component: BigFiveTest,
      color: 'text-blue-500'
    },
    {
      id: 'archetypes',
      title: '–¢–µ—Å—Ç –Ω–∞ –∞—Ä—Ö–µ—Ç–∏–ø—ã (85 –≤–æ–ø—Ä–æ—Å–æ–≤)',
      description: '–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–≤–æ–∏ –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–µ –∞—Ä—Ö–µ—Ç–∏–ø—ã',
      longDescription: '–ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –Ω–∞ –∞—Ä—Ö–µ—Ç–∏–ø—ã —Å 85 –≤–æ–ø—Ä–æ—Å–∞–º–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è 12 –æ—Å–Ω–æ–≤–Ω—ã—Ö –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤ –ª–∏—á–Ω–æ—Å—Ç–∏: –ù–µ–≤–∏–Ω–Ω—ã–π, –°–∏—Ä–æ—Ç–∞/–û–±—ã–≤–∞—Ç–µ–ª—å, –ì–µ—Ä–æ–π, –ó–∞–±–æ—Ç–ª–∏–≤—ã–π, –ò—Å–∫–∞—Ç–µ–ª—å, –ë—É–Ω—Ç–∞—Ä—å, –õ—é–±–æ–≤–Ω–∏–∫, –¢–≤–æ—Ä–µ—Ü, –®—É—Ç, –ú—É–¥—Ä–µ—Ü, –ú–∞–≥, –ü—Ä–∞–≤–∏—Ç–µ–ª—å. –ö–∞–∂–¥—ã–π –∞—Ä—Ö–µ—Ç–∏–ø –≤–∫–ª—é—á–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é, —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã, —Å–ª–∞–±–æ—Å—Ç–∏, —Å—Ç—Ä–∞—Ö–∏, —Ü–µ–ª–∏ –∏ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –æ–∫—Ä—É–∂–∞—é—â–∏–º–∏.',
      icon: Crown,
      component: ArchetypeTest,
      color: 'text-amber-500'
    },
    {
      id: 'stress',
      title: '–¢–µ—Å—Ç –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Å—Ç—Ä–µ—Å—Å–∞',
      description: '–ê–≤—Ç–æ—Ä—Å–∫–∏–π —Ç–µ—Å—Ç –∏–∑ 40 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —É—Ä–æ–≤–Ω—è —Å—Ç—Ä–µ—Å—Å–∞ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è',
      longDescription: '–ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –Ω–∞ —Å—Ç—Ä–µ—Å—Å —Å 40 –≤–æ–ø—Ä–æ—Å–∞–º–∏ –ø–æ 4 –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º: –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –§–∏–∑–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è, –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –ø—Ä–∏–≤—ã—á–∫–∏, –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã. –í–∫–ª—é—á–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è —Å—Ç—Ä–µ—Å—Å–∞ (–Ω–∏–∑–∫–∏–π, —É–º–µ—Ä–µ–Ω–Ω—ã–π, –≤—ã—Å–æ–∫–∏–π, –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π) —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.',
      icon: Activity,
      component: StressTest,
      color: 'text-red-500'
    }
  ];

  const handleStartTest = (testId: string) => {
    setActiveTest(testId);
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
    if (testId === 'archetypes') {
      resetArchetypeState();
    }
  };

  const handleTestComplete = (testId: string, result: string | { type: string; scores: MbtiScores } | BigFiveResult[] | ArchetypeResult[] | StressResult) => {
    if (testId === 'mbti' && typeof result === 'object' && 'type' in result) {
      // –î–ª—è MBTI —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –æ—Ü–µ–Ω–∫–∞–º–∏
      setTestResults(prev => ({
        ...prev,
        [testId]: { testId, type: result.type, scores: result.scores }
      }));
    } else if (testId === 'big-five' && Array.isArray(result)) {
      // –î–ª—è Big Five —Å–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞—Å—Å–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      setTestResults(prev => ({
        ...prev,
        [testId]: result
      }));
    } else if (testId === 'archetypes' && Array.isArray(result)) {
      // –î–ª—è —Ç–µ—Å—Ç–∞ –Ω–∞ –∞—Ä—Ö–µ—Ç–∏–ø—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞—Å—Å–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      setTestResults(prev => ({
        ...prev,
        [testId]: result
      }));
    } else if (testId === 'stress' && typeof result === 'object' && 'level' in result) {
      // –î–ª—è —Ç–µ—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      setTestResults(prev => ({
        ...prev,
        [testId]: result
      }));
    } else {
      // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç—Ä–æ–∫—É
      setTestResults(prev => ({
        ...prev,
        [testId]: result as string
      }));
    }
    setActiveTest(null);
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞
    if (testId === 'archetypes') {
      resetArchetypeState();
    }
  };

  const getStatus = (testId: string) => {
    if (activeTest === testId) {
      return { 
        icon: 'üïì', 
        text: '–í –ø—Ä–æ—Ü–µ—Å—Å–µ', 
        className: 'text-blue-600 bg-blue-100 dark:bg-blue-900/30 dark:text-blue-400',
        time: testId === 'big-five' ? '20-30 –º–∏–Ω' : testId === 'archetypes' ? '25-35 –º–∏–Ω' : testId === 'stress' ? '15-25 –º–∏–Ω' : '10-20 –º–∏–Ω'
      };
    }
    if (testResults[testId]) {
      return { 
        icon: '‚úÖ', 
        text: '–ü—Ä–æ–π–¥–µ–Ω', 
        className: 'text-green-600 bg-green-100 dark:bg-green-900/30 dark:text-green-400',
        time: testId === 'big-five' ? '20-30 –º–∏–Ω' : testId === 'archetypes' ? '25-35 –º–∏–Ω' : testId === 'stress' ? '15-25 –º–∏–Ω' : '10-20 –º–∏–Ω'
      };
    }
    return { 
      icon: '‚¨ú', 
      text: '–ù–µ –ø—Ä–æ–π–¥–µ–Ω', 
      className: 'text-gray-600 bg-gray-100 dark:bg-gray-700/30 dark:text-gray-400',
      time: testId === 'big-five' ? '20-30 –º–∏–Ω' : testId === 'archetypes' ? '25-35 –º–∏–Ω' : testId === 'stress' ? '15-25 –º–∏–Ω' : '10-20 –º–∏–Ω'
    };
  };

  const generateShareText = (testId: string, result: any) => {
    const testNames: Record<string, string> = {
      'mbti': '–¢–µ—Å—Ç MBTI',
      'big-five': '–¢–µ—Å—Ç Big Five',
      'archetypes': '–¢–µ—Å—Ç –Ω–∞ –∞—Ä—Ö–µ—Ç–∏–ø—ã (85 –≤–æ–ø—Ä–æ—Å–æ–≤)',
      'stress': '–¢–µ—Å—Ç –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Å—Ç—Ä–µ—Å—Å–∞'
    };

    const testName = testNames[testId] || '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç';
    
    if (testId === 'mbti') {
      if (typeof result === 'object' && result !== null && 'type' in result) {
        const mbtiTitles: Record<string, string> = {
          'INTJ': '–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä',
          'INTP': '–õ–æ–≥–∏–∫',
          'ENTJ': '–ö–æ–º–∞–Ω–¥–∏—Ä',
          'ENTP': '–ù–æ–≤–∞—Ç–æ—Ä',
          'INFJ': '–ê–¥–≤–æ–∫–∞—Ç',
          'INFP': '–ü–æ—Å—Ä–µ–¥–Ω–∏–∫',
          'ENFJ': '–ü—Ä–æ—Ç–∞–≥–æ–Ω–∏—Å—Ç',
          'ENFP': '–ê–∫—Ç–∏–≤–∏—Å—Ç',
          'ISTJ': '–õ–æ–≥–∏—Å—Ç',
          'ISFJ': '–ó–∞—â–∏—Ç–Ω–∏–∫',
          'ESTJ': '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å',
          'ESFJ': '–ö–æ–Ω—Å—É–ª',
          'ISTP': '–í–∏—Ä—Ç—É–æ–∑',
          'ISFP': '–ê–≤–∞–Ω—Ç—é—Ä–∏—Å—Ç',
          'ESTP': '–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å',
          'ESFP': '–†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å'
        };
        
        const title = mbtiTitles[result.type] || result.type;
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
        const fullDescription = generateFullMbtiDescription(result.type, title);
        
        return `üéØ ${testName}\n\n‚ú® –ú–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${title} (${result.type})\n\n${fullDescription}\n\nüîç –ü—Ä–æ—à–µ–ª —Ç–µ—Å—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ü—Ä–æ—Ç–µ–π!\n\n#MBTI #–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è #–ü—Ä–æ—Ç–µ–π`;
      } else if (typeof result === 'string') {
        const match = result.match(/\((E|I)(S|N)(T|F)(J|P)\)/);
        if (match) {
          const type = match[0].replace(/[()]/g, '');
          const title = result.split('(')[0].trim();
          const fullDescription = generateFullMbtiDescription(type, title);
          return `üéØ ${testName}\n\n‚ú® –ú–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${title} (${type})\n\n${fullDescription}\n\nüîç –ü—Ä–æ—à–µ–ª —Ç–µ—Å—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ü—Ä–æ—Ç–µ–π!\n\n#MBTI #–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è #–ü—Ä–æ—Ç–µ–π`;
        }
      }
    } else if (testId === 'archetypes' && Array.isArray(result)) {
      // –î–ª—è —Ç–µ—Å—Ç–∞ –Ω–∞ –∞—Ä—Ö–µ—Ç–∏–ø—ã
      const sortedResults = [...result].sort((a: any, b: any) => b.score - a.score);
      const topArchetype = sortedResults[0];
      
      if (topArchetype) {
        const archetypeNames: Record<string, string> = {
          'innocent': '–ù–µ–≤–∏–Ω–Ω—ã–π',
          'everyman': '–°–∏—Ä–æ—Ç–∞/–û–±—ã–≤–∞—Ç–µ–ª—å',
          'hero': '–ì–µ—Ä–æ–π',
          'caregiver': '–ó–∞–±–æ—Ç–ª–∏–≤—ã–π',
          'explorer': '–ò—Å–∫–∞—Ç–µ–ª—å',
          'rebel': '–ë—É–Ω—Ç–∞—Ä—å',
          'lover': '–õ—é–±–æ–≤–Ω–∏–∫',
          'creator': '–¢–≤–æ—Ä–µ—Ü',
          'jester': '–®—É—Ç',
          'sage': '–ú—É–¥—Ä–µ—Ü',
          'magician': '–ú–∞–≥',
          'ruler': '–ü—Ä–∞–≤–∏—Ç–µ–ª—å'
        };
        
        const archetypeName = archetypeNames[topArchetype.archetype] || topArchetype.archetype;
        const levelText = topArchetype.level === 'weak' ? '—Å–ª–∞–±–æ –≤—ã—Ä–∞–∂–µ–Ω' :
                         topArchetype.level === 'moderate' ? '—É–º–µ—Ä–µ–Ω–Ω–æ –≤—ã—Ä–∞–∂–µ–Ω' :
                         topArchetype.level === 'strong' ? '—Å–∏–ª—å–Ω–æ –≤—ã—Ä–∞–∂–µ–Ω' :
                         '–æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –≤—ã—Ä–∞–∂–µ–Ω';
        
        return `üé≠ ${testName}\n\n‚ú® –ú–æ–π –≤–µ–¥—É—â–∏–π –∞—Ä—Ö–µ—Ç–∏–ø: ${archetypeName}\n\nüîπ –£—Ä–æ–≤–µ–Ω—å –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ—Å—Ç–∏: ${levelText}\nüîπ –ë–∞–ª–ª—ã: ${topArchetype.score}/${topArchetype.maxScore} (${topArchetype.percentage}%)\n\nüîç –ü—Ä–æ—à–µ–ª —Ç–µ—Å—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ü—Ä–æ—Ç–µ–π!\n\n#–ê—Ä—Ö–µ—Ç–∏–ø—ã #–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è #–ü—Ä–æ—Ç–µ–π`;
      }
    } else if (testId === 'stress' && typeof result === 'object' && result !== null && 'level' in result) {
      // –î–ª—è —Ç–µ—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–µ—Å—Å
      const stressResult = result as StressResult;
      const levelEmoji = stressResult.level === 'low' ? 'üü¢' :
                        stressResult.level === 'moderate' ? 'üü°' :
                        stressResult.level === 'high' ? 'üü†' :
                        'üî¥';
      
      return `üß† ${testName}\n\n${levelEmoji} –ú–æ–π —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞: ${stressResult.levelName}\n\nüîπ –ë–∞–ª–ª—ã: ${stressResult.score}/${stressResult.maxScore} (${stressResult.percentage}%)\nüîπ –û–ø–∏—Å–∞–Ω–∏–µ: ${stressResult.description.split('\n')[0]}\n\nüîç –ü—Ä–æ—à–µ–ª —Ç–µ—Å—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ü—Ä–æ—Ç–µ–π!\n\n#–°—Ç—Ä–µ—Å—Å #–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è #–ü—Ä–æ—Ç–µ–π`;
    }
    
    // –î–ª—è –¥—Ä—É–≥–∏—Ö —Ç–µ—Å—Ç–æ–≤
    return `üéØ ${testName}\n\n‚ú® –ü—Ä–æ—à–µ–ª –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ü—Ä–æ—Ç–µ–π!\n\nüîç –£–∑–Ω–∞–ª –º–Ω–æ–≥–æ –Ω–æ–≤–æ–≥–æ –æ —Å–µ–±–µ –∏ —Å–≤–æ–µ–π –ª–∏—á–Ω–æ—Å—Ç–∏.\n\n#–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è #–°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ #–ü—Ä–æ—Ç–µ–π`;
  };

  const generateFullMbtiDescription = (type: string, title: string) => {
    const descriptions: Record<string, string> = {
      'INTJ': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî INTJ (¬´–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä¬ª). –≠—Ç–æ –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —Ä–µ–¥–∫–∏—Ö —Ç–∏–ø–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ MBTI. –í–∞—Å —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞—é—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ –≤—ã —Å–∫–ª–æ–Ω–Ω—ã –º—ã—Å–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏, –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –ø–ª–∞–Ω—ã –∏ –≤–∏–¥–µ—Ç—å –º–∏—Ä –∫–∞–∫ —Å–∏—Å—Ç–µ–º—É, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ —É–ª—É—á—à–∞—Ç—å. –í–∞—à–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ ‚Äî –≤—ã —É–º–µ–µ—Ç–µ –≤–∏–¥–µ—Ç—å –∫–∞—Ä—Ç–∏–Ω—É —Ü–µ–ª–∏–∫–æ–º –∏ –ø—Ä–æ—Å—á–∏—Ç—ã–≤–∞—Ç—å —à–∞–≥–∏ –Ω–∞–ø–µ—Ä—ë–¥\n‚Ä¢ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å ‚Äî –¥–ª—è –≤–∞—Å –≤–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –º–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞\n‚Ä¢ –ò–Ω–Ω–æ–≤–∞—Ü–∏–∏ ‚Äî –≤—ã —Å–∫–ª–æ–Ω–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è —Ç–∞–º, –≥–¥–µ –¥—Ä—É–≥–∏–µ –≤–∏–¥—è—Ç —Ç—É–ø–∏–∫\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –î–∞–ª—å–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç—å –∏ —É–º–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å\n‚Ä¢ –°–∏—Å—Ç–µ–º–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ\n‚Ä¢ –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Ü–µ–ª—è—Ö\n‚Ä¢ –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å\n‚Ä¢ –£–º–µ–Ω–∏–µ –Ω–∞—Ö–æ–¥–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è`,
      'INTP': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî INTP (¬´–õ–æ–≥–∏–∫¬ª). –≠—Ç–æ –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —Ä–µ–¥–∫–∏—Ö –∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ MBTI. –õ—é–¥–µ–π —Å —Ç–∞–∫–∏–º —Å–∫–ª–∞–¥–æ–º —É–º–∞ –æ—Ç–ª–∏—á–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ, –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å. –í—ã —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –ø–æ–Ω—è—Ç—å —Å—É—Ç—å —è–≤–ª–µ–Ω–∏–π, —Ä–∞–∑–ª–æ–∂–∏—Ç—å —Å–ª–æ–∂–Ω–æ–µ –Ω–∞ —á–∞—Å—Ç–∏ –∏ —Å–æ–±—Ä–∞—Ç—å –∏–∑ —ç—Ç–æ–≥–æ –Ω–æ–≤—ã–µ –∏–¥–µ–∏ –∏–ª–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —É–º ‚Äî –≤—ã —Å–∫–ª–æ–Ω–Ω—ã –≥–ª—É–±–æ–∫–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç\n‚Ä¢ –õ—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî —É –≤–∞—Å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –∑–Ω–∞–Ω–∏—è–º –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—é\n‚Ä¢ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å ‚Äî –≤–∞—à–µ –º—ã—à–ª–µ–Ω–∏–µ –Ω–µ–æ–±—ã—á–Ω–æ –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≥–ª—É–±–æ–∫–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é\n‚Ä¢ –ë–æ–≥–∞—Ç–æ–µ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏–¥–µ–π\n‚Ä¢ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º—ã—à–ª–µ–Ω–∏—è\n‚Ä¢ –ì–∏–±–∫–æ—Å—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –Ω–æ–≤—ã–º –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º`,
      'ENTJ': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî ENTJ (¬´–ö–æ–º–∞–Ω–¥–∏—Ä¬ª). –≠—Ç–æ –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —Å–∏–ª—å–Ω—ã—Ö –∏ —ç–Ω–µ—Ä–≥–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ MBTI. –õ—é–¥–µ–π —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –æ—Ç–ª–∏—á–∞–µ—Ç –ª–∏–¥–µ—Ä—Å—Ç–≤–æ, —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –í—ã –≤–∏–¥–∏—Ç–µ —Ü–µ–ª–∏ —è—Å–Ω–æ –∏ —É–º–µ–µ—Ç–µ –≤–µ—Å—Ç–∏ –¥—Ä—É–≥–∏—Ö –∑–∞ —Å–æ–±–æ–π, –ø—Ä–µ–≤—Ä–∞—â–∞—è –∏–¥–µ–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –õ–∏–¥–µ—Ä—Å—Ç–≤–æ ‚Äî —É –≤–∞—Å –≤—Ä–æ–∂–¥—ë–Ω–Ω—ã–π —Ç–∞–ª–∞–Ω—Ç —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è\n‚Ä¢ –†–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî –≤—ã –Ω–µ –±–æ–∏—Ç–µ—Å—å –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è, –¥–∞–∂–µ –≤ —Å–ª–æ–∂–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö\n‚Ä¢ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –≤—ã —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –∏ —É–º–µ–µ—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –°–∏–ª—å–Ω—ã–µ –ª–∏–¥–µ—Ä—Å–∫–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞\n‚Ä¢ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ\n‚Ä¢ –í—ã—Å–æ–∫–∞—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏ —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª—ë–Ω–Ω–æ—Å—Ç—å\n‚Ä¢ –£–º–µ–Ω–∏–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –±—ã—Å—Ç—Ä—ã–µ –∏ —Ç–æ—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è`,
      'ENTP': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî ENTP (¬´–ù–æ–≤–∞—Ç–æ—Ä¬ª). –í–∞—Å –æ—Ç–ª–∏—á–∞—é—Ç –ø—Ä–µ–¥–ø—Ä–∏–∏–º—á–∏–≤–æ—Å—Ç—å, –Ω–∞—Ö–æ–¥—á–∏–≤–æ—Å—Ç—å –∏ —ç–Ω—Ç—É–∑–∏–∞–∑–º. –í—ã —á–µ–ª–æ–≤–µ–∫ –∏–¥–µ–π, —ç–Ω–µ—Ä–≥–∏–∏ –∏ –¥–≤–∏–∂–µ–Ω–∏—è. –í–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –±—Ä–æ—Å–∞—Ç—å –≤—ã–∑–æ–≤ –ø—Ä–∏–≤—ã—á–Ω—ã–º —Å–∏—Å—Ç–µ–º–∞–º –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–≤–µ–∂–∏–µ —Ä–µ—à–µ–Ω–∏—è —Ç–∞–º, –≥–¥–µ –¥—Ä—É–≥–∏–µ –¥–∞–∂–µ –Ω–µ –¥—É–º–∞—é—Ç –∏—Å–∫–∞—Ç—å.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –ü—Ä–µ–¥–ø—Ä–∏–∏–º—á–∏–≤–æ—Å—Ç—å ‚Äî –≤—ã –±—ã—Å—Ç—Ä–æ —Å—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç–µ —Å—É—Ç—å –∏ –≤–∏–¥–∏—Ç–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª\n‚Ä¢ –ù–∞—Ö–æ–¥—á–∏–≤–æ—Å—Ç—å ‚Äî –≤—ã —Å–ø–æ—Å–æ–±–Ω—ã –∏–º–ø—Ä–æ–≤–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –≤—ã—Ö–æ–¥ –∏–∑ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π\n‚Ä¢ –≠–Ω—Ç—É–∑–∏–∞–∑–º ‚Äî –≤—ã –∑–∞—Ä—è–∂–∞–µ—Ç–µ –æ–∫—Ä—É–∂–∞—é—â–∏—Ö —ç–Ω–µ—Ä–≥–∏–µ–π –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ–º\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –•–∞—Ä–∏–∑–º–∞ –∏ —É–º–µ–Ω–∏–µ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å –¥—Ä—É–≥–∏—Ö\n‚Ä¢ –ì–∏–±–∫–æ—Å—Ç—å –º—ã—à–ª–µ–Ω–∏—è –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å —Ä–µ—à–µ–Ω–∏—è\n‚Ä¢ –≠–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–º\n‚Ä¢ –¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ –∫ –∑–∞–¥–∞—á–∞–º`,
      'INFJ': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî INFJ (¬´–ê–¥–≤–æ–∫–∞—Ç¬ª). –≠—Ç–æ –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —Ä–µ–¥–∫–∏—Ö –∏ –∑–∞–≥–∞–¥–æ—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ MBTI. INFJ –æ—Ç–ª–∏—á–∞–µ—Ç —Å–æ—á–µ—Ç–∞–Ω–∏–µ –∏–¥–µ–∞–ª–∏–∑–º–∞, —ç–º–ø–∞—Ç–∏–∏ –∏ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è. –í—ã —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –≥–ª—É–±–æ–∫–æ–º—É –ø–æ–Ω–∏–º–∞–Ω–∏—é –ª—é–¥–µ–π –∏ –∏—Å–∫—Ä–µ–Ω–Ω–µ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å –º–∏—Ä –ª—É—á—à–µ, —Å–æ–µ–¥–∏–Ω—è—è –≤ —Å–µ–±–µ –º–µ—á—Ç–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –ò–¥–µ–∞–ª–∏–∑–º ‚Äî –≤—ã –≤–µ—Ä–∏—Ç–µ –≤ —Ü–µ–Ω–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –∏ –≤ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω –∫ –ª—É—á—à–µ–º—É\n‚Ä¢ –≠–º–ø–∞—Ç–∏—è ‚Äî —É –≤–∞—Å —è—Ä–∫–æ –≤—ã—Ä–∞–∂–µ–Ω–Ω–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ —ç–º–æ—Ü–∏—è–º –¥—Ä—É–≥–∏—Ö –ª—é–¥–µ–π\n‚Ä¢ –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ ‚Äî –≤—ã —Å–∫–ª–æ–Ω–Ω—ã –º—ã—Å–ª–∏—Ç—å –æ–±—Ä–∞–∑–∞–º–∏ –∏ —Å–∏–º–≤–æ–ª–∞–º–∏\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –°–∏–ª—å–Ω–æ–µ —á—É–≤—Å—Ç–≤–æ –∏–Ω—Ç—É–∏—Ü–∏–∏\n‚Ä¢ –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ –≥–ª—É–±–æ–∫–∏–º –∏ –∏—Å–∫—Ä–µ–Ω–Ω–∏–º –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º\n‚Ä¢ –£–º–µ–Ω–∏–µ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö\n‚Ä¢ –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –º—ã—à–ª–µ–Ω–∏—è`,
      'INFP': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî INFP (¬´–ü–æ—Å—Ä–µ–¥–Ω–∏–∫¬ª). –õ—é–¥–µ–π —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –æ—Ç–ª–∏—á–∞—é—Ç –∞–ª—å—Ç—Ä—É–∏–∑–º, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ –∏ –∏–¥–µ–∞–ª–∏–∑–º. –í—ã —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∂–∏—Ç—å –≤ —Å–æ–≥–ª–∞—Å–∏–∏ —Å–æ —Å–≤–æ–∏–º–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º–∏ –∏ –≤–∏–¥–∏—Ç–µ —Å–º—ã—Å–ª –≤ —Ç–æ–º, —á—Ç–æ–±—ã –ø–æ–º–æ–≥–∞—Ç—å –¥—Ä—É–≥–∏–º. –ß–∞—Å—Ç–æ –≤—ã –æ—â—É—â–∞–µ—Ç–µ —Å–µ–±—è –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–º –º–µ–∂–¥—É —Ä–µ–∞–ª—å–Ω—ã–º –∏ –∏–¥–µ–∞–ª—å–Ω—ã–º –º–∏—Ä–æ–º.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –ê–ª—å—Ç—Ä—É–∏–∑–º ‚Äî –≤–∞–º —Å–≤–æ–π—Å—Ç–≤–µ–Ω–Ω–æ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –ø–æ–º–æ–≥–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö\n‚Ä¢ –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ ‚Äî –≤–∞—à–µ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–æ–≥–∞—Ç–æ, –∞ –≤–∑–≥–ª—è–¥ –Ω–∞ –º–∏—Ä ‚Äî –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π\n‚Ä¢ –ò–¥–µ–∞–ª–∏–∑–º ‚Äî –≤—ã –≤–µ—Ä–∏—Ç–µ –≤ —Å–∏–ª—É –∏–¥–µ–π –∏ —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π, —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –≥–∞—Ä–º–æ–Ω–∏–∏\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –ò—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≥–ª—É–±–æ–∫–æ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å\n‚Ä¢ –ë–æ–≥–∞—Ç–æ–µ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å\n‚Ä¢ –£–º–µ–Ω–∏–µ –≤–∏–¥–µ—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –≤ –ª—é–¥—è—Ö –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏—Ö\n‚Ä¢ –í–µ—Ä–Ω–æ—Å—Ç—å —Å–≤–æ–∏–º —É–±–µ–∂–¥–µ–Ω–∏—è–º`,
      'ISTJ': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî ISTJ (¬´–õ–æ–≥–∏—Å—Ç¬ª). –í–∞—Å –æ—Ç–ª–∏—á–∞—é—Ç –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å. –í—ã —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –∏ —è—Å–Ω–æ—Å—Ç—å, —É–º–µ–µ—Ç –±—Ä–∞—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∏ –¥–æ–±–∏–≤–∞—Ç—å—Å—è —Ü–µ–ª–µ–π —á–µ—Ä–µ–∑ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –õ—é–¥–∏ –≤–∞—à–µ–≥–æ —Ç–∏–ø–∞ —á–∞—Å—Ç–æ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è ¬´–æ–ø–æ—Ä–æ–π¬ª –¥–ª—è –æ–∫—Ä—É–∂–∞—é—â–∏—Ö.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å ‚Äî –≤—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏ –∑–¥—Ä–∞–≤—ã–π —Å–º—ã—Å–ª\n‚Ä¢ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å ‚Äî –Ω–∞ –≤–∞—Å –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å—Å—è, –≤—ã –≤—Å–µ–≥–¥–∞ –¥–æ–≤–æ–¥–∏—Ç–µ –¥–µ–ª–æ –¥–æ –∫–æ–Ω—Ü–∞\n‚Ä¢ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å ‚Äî –≤—ã —Ü–µ–Ω–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —É–º–µ–µ—Ç–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å\n‚Ä¢ –†–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å\n‚Ä¢ –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –¥–µ—Ç–∞–ª—è–º\n‚Ä¢ –°—Ç–æ–π–∫–æ—Å—Ç—å –∏ —É–º–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –¥–æ–ª–≥—É—é`,
      'ISFJ': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî ISFJ (¬´–ó–∞—â–∏—Ç–Ω–∏–∫¬ª). –í–∞—Å –æ—Ç–ª–∏—á–∞—é—Ç –ø—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç—å, –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å –∏ –∑–∞–±–æ—Ç–∞. –í—ã —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–∫—Ä–µ–Ω–Ω–µ —Ü–µ–Ω–∏—Ç –≥–∞—Ä–º–æ–Ω–∏—é –∏ –≥–æ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö, —Å–æ–∑–¥–∞–≤–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –∏ —É—é—Ç–∞. –î–ª—è –≤–∞—Å –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –±–ª–∏–∑–∫–∏–µ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ —Å–µ–±—è –∑–∞—â–∏—â—ë–Ω–Ω—ã–º–∏.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –ü—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç—å ‚Äî –≤—ã –≤–µ—Ä–Ω—ã —Å–≤–æ–∏–º —Ü–µ–Ω–Ω–æ—Å—Ç—è–º –∏ –ª—é–¥—è–º, –∫–æ—Ç–æ—Ä—ã–º –¥–æ–≤–µ—Ä—è–µ—Ç–µ\n‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å ‚Äî –≤—ã —Ç—Ä–µ–∑–≤–æ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è\n‚Ä¢ –ó–∞–±–æ—Ç–∞ ‚Äî –≤—ã —Ç–æ–Ω–∫–æ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –¥—Ä—É–≥–∏—Ö –∏ —Å—Ç–∞—Ä–∞–µ—Ç–µ—Å—å –ø–æ–º–æ—á—å\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –í–µ—Ä–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å\n‚Ä¢ –≠–º–ø–∞—Ç–∏—è –∏ –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è–º –¥—Ä—É–≥–∏—Ö\n‚Ä¢ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å\n‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å –∏ –∑–¥—Ä–∞–≤—ã–π —Å–º—ã—Å–ª`,
      'ESTJ': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî ESTJ (¬´–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å¬ª). –í–∞—Å –æ—Ç–ª–∏—á–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –ª–∏–¥–µ—Ä—Å—Ç–≤–æ. –í—ã —á–µ–ª–æ–≤–µ–∫ –¥–µ–ª–∞, –∫–æ—Ç–æ—Ä—ã–π —Ü–µ–Ω–∏—Ç –ø–æ—Ä—è–¥–æ–∫, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É –∏ —è—Å–Ω–æ—Å—Ç—å. –í—ã —É–º–µ–µ—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –∏ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Ç–µ–º, —á—Ç–æ–±—ã –≤—Å—ë —Ä–∞–±–æ—Ç–∞–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –≤–æ–≤—Ä–µ–º—è.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –≤—ã —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\n‚Ä¢ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å ‚Äî –Ω–∞ –≤–∞—Å –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å—Å—è, –≤—ã –≤—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ –æ–±–µ—â–∞–Ω–∏—è\n‚Ä¢ –õ–∏–¥–µ—Ä—Å—Ç–≤–æ ‚Äî –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è —É–≤–µ—Ä–µ–Ω–Ω–æ –≤ —Ä–æ–ª–∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å\n‚Ä¢ –í—ã—Å–æ–∫–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å\n‚Ä¢ –†–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å\n‚Ä¢ –£–º–µ–Ω–∏–µ —Ä—É–∫–æ–≤–æ–¥–∏—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏`,
      'ESFJ': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî ESFJ (¬´–ö–æ–Ω—Å—É–ª¬ª). –í–∞—Å –æ—Ç–ª–∏—á–∞—é—Ç –∑–∞–±–æ—Ç–∞, –æ–±—â–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å. –í—ã —á–µ–ª–æ–≤–µ–∫, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω—ã –≥–∞—Ä–º–æ–Ω–∏—è –∏ —Ö–æ—Ä–æ—à–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –æ–∫—Ä—É–∂–∞—é—â–∏–º–∏. –í—ã —É–º–µ–µ—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö, —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞—Ç–º–æ—Å—Ñ–µ—Ä—É —É—é—Ç–∞ –∏ –µ–¥–∏–Ω—Å—Ç–≤–∞, –∞ —Ç–∞–∫–∂–µ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å –ª—é–¥–µ–π —Å–≤–æ–∏–º –ø—Ä–∏–º–µ—Ä–æ–º.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –ó–∞–±–æ—Ç–∞ ‚Äî –≤—ã –∏—Å–∫—Ä–µ–Ω–Ω–µ —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –ø–æ–º–æ–≥–∞—Ç—å –¥—Ä—É–≥–∏–º –∏ –¥–µ–ª–∞—Ç—å –∏—Ö –∂–∏–∑–Ω—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω–µ–µ\n‚Ä¢ –û–±—â–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî –≤—ã –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ –æ–±—â–∏–π —è–∑—ã–∫ —Å –ª—é–¥—å–º–∏ –∏ —Ü–µ–Ω–∏—Ç–µ —Ç—ë–ø–ª–æ–µ –æ–±—â–µ–Ω–∏–µ\n‚Ä¢ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å ‚Äî –Ω–∞ –≤–∞—Å –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å—Å—è, –≤—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –≠–º–ø–∞—Ç–∏—è –∏ —É–º–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö\n‚Ä¢ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å\n‚Ä¢ –õ—ë–≥–∫–æ—Å—Ç—å –≤ –æ–±—â–µ–Ω–∏–∏, —Ö–∞—Ä–∏–∑–º–∞\n‚Ä¢ –°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –≥–∞—Ä–º–æ–Ω–∏–∏ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤—É`,
      'ISTP': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî ISTP (¬´–í–∏—Ä—Ç—É–æ–∑¬ª). –í–∞—Å –æ—Ç–ª–∏—á–∞—é—Ç –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å, —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å –∏ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ. –í—ã —á–µ–ª–æ–≤–µ–∫ –¥–µ–π—Å—Ç–≤–∏—è, –∞ –Ω–µ —Å–ª–æ–≤. –í–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ —Ç–æ–º, –∫–∞–∫ –≤—Å—ë —É—Å—Ç—Ä–æ–µ–Ω–æ, –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è. –í—ã —Ü–µ–Ω–∏—Ç–µ —Å–≤–æ–±–æ–¥—É, –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ —É—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ –æ–ø—ã—Ç.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å ‚Äî –≤—ã –≤—Å–µ–≥–¥–∞ –∏—â–µ—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Ä–µ—à–µ–Ω–∏—è\n‚Ä¢ –°–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å ‚Äî –≤—ã –ª—é–±–∏—Ç–µ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å, –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø–ª–∞–Ω–æ–≤\n‚Ä¢ –ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ ‚Äî —É –≤–∞—Å ¬´–∑–æ–ª–æ—Ç—ã–µ —Ä—É–∫–∏¬ª –∏ —Ç–∞–ª–∞–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å\n‚Ä¢ –ì–∏–±–∫–æ—Å—Ç—å –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å\n‚Ä¢ –£–º–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ö–ª–∞–¥–Ω–æ–∫—Ä–æ–≤–∏–µ –≤ —Å–ª–æ–∂–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö\n‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ –∏ —Ç–∞–ª–∞–Ω—Ç –∫ —Ä–µ–º–µ—Å–ª–∞–º`,
      'ISFP': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî ISFP (¬´–ê–≤–∞–Ω—Ç—é—Ä–∏—Å—Ç¬ª). –í–∞—Å –æ—Ç–ª–∏—á–∞—é—Ç —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å. –í—ã —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π —Ü–µ–Ω–∏—Ç –∫—Ä–∞—Å–æ—Ç—É –∂–∏–∑–Ω–∏ –≤–æ –≤—Å–µ—Ö –µ—ë –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è—Ö. –£ –≤–∞—Å —Ç–æ–Ω–∫–æ–µ —á—É–≤—Å—Ç–≤–æ —Å—Ç–∏–ª—è, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –≥–∞—Ä–º–æ–Ω–∏–∏ –∏ –∂–µ–ª–∞–Ω–∏–µ –ø—Ä–æ–∂–∏–≤–∞—Ç—å –∫–∞–∂–¥–æ–µ –º–≥–Ω–æ–≤–µ–Ω–∏–µ –∏—Å–∫—Ä–µ–Ω–Ω–µ.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å ‚Äî –≤—ã –≤–∏–¥–∏—Ç–µ –∫—Ä–∞—Å–æ—Ç—É —Ç–∞–º, –≥–¥–µ –¥—Ä—É–≥–∏–µ –º–æ–≥—É—Ç –µ—ë –Ω–µ –∑–∞–º–µ—á–∞—Ç—å\n‚Ä¢ –°–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å ‚Äî –≤—ã –∂–∏–≤—ë—Ç–µ ¬´–∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å¬ª, –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—é\n‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å ‚Äî –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–≤–æ—Ä—á–µ—Å–∫—É—é –Ω–∞—Ç—É—Ä—É, –≤—ã —É–º–µ–µ—Ç–µ —Ä–µ—à–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –≠–º–ø–∞—Ç–∏—è –∏ –≥–ª—É–±–æ–∫–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å\n‚Ä¢ –¢–≤–æ—Ä—á–µ—Å–∫–∏–π –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥\n‚Ä¢ –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è –ø—Ä–æ—Å—Ç—ã–º –≤–µ—â–∞–º\n‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã—Ö –¥–µ–ª–∞—Ö`,
      'ESTP': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî ESTP (¬´–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å¬ª). –í–∞—Å –æ—Ç–ª–∏—á–∞—é—Ç —ç–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å, –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å –∏ —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å. –í—ã —á–µ–ª–æ–≤–µ–∫ –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –∂–∏—Ç—å –∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å, –∞ –Ω–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –∂–∏–∑–Ω—å –Ω–∞ –ø–æ—Ç–æ–º. –í–∞—à–∞ —ç–Ω–µ—Ä–≥–∏—è –∑–∞—Ä—è–∂–∞–µ—Ç –æ–∫—Ä—É–∂–∞—é—â–∏—Ö, –∞ —É–º–µ–Ω–∏–µ –±—ã—Å—Ç—Ä–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –ø–æ–º–æ–≥–∞–µ—Ç –≤–∞–º —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º–∏ —Å–∏—Ç—É–∞—Ü–∏—è–º–∏.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –≠–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å ‚Äî –≤—ã –ø–æ–ª–Ω—ã —Å–∏–ª –∏ —ç–Ω—Ç—É–∑–∏–∞–∑–º–∞, –æ–±–æ–∂–∞–µ—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –¥–≤–∏–∂–µ–Ω–∏–µ\n‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å ‚Äî –¥–ª—è –≤–∞—Å –≤–∞–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∞ –Ω–µ –ø—É—Å—Ç—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã\n‚Ä¢ –°–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å ‚Äî –≤—ã –ª—é–±–∏—Ç–µ –∏–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏—é –∏ –∞–∑–∞—Ä—Ç\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –•–∞—Ä–∏–∑–º–∞ –∏ —É–º–µ–Ω–∏–µ –Ω–∞—Ö–æ–¥–∏—Ç—å –æ–±—â–∏–π —è–∑—ã–∫ —Å –ª—é–¥—å–º–∏\n‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è –∏ —É–º–µ–Ω–∏–µ —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏ –≤ –º–æ–º–µ–Ω—Ç–µ\n‚Ä¢ –û–ø—Ç–∏–º–∏–∑–º –∏ –∂–∏–∑–Ω–µ—Ä–∞–¥–æ—Å—Ç–Ω–æ—Å—Ç—å\n‚Ä¢ –ì–∏–±–∫–æ—Å—Ç—å –∏ –Ω–∞—Ö–æ–¥—á–∏–≤–æ—Å—Ç—å`,
      'ESFP': `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî ESFP (¬´–†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å¬ª). –í–∞—Å –æ—Ç–ª–∏—á–∞—é—Ç —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å, —ç–Ω—Ç—É–∑–∏–∞–∑–º –∏ –¥—Ä—É–∂–µ–ª—é–±–∏–µ. –í—ã ‚Äî –¥—É—à–∞ –∫–æ–º–ø–∞–Ω–∏–∏, —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è –∂–∏–∑–Ω–∏ –∏ –¥–µ–ª–∏—Ç—å—Å—è —ç—Ç–æ–π —Ä–∞–¥–æ—Å—Ç—å—é —Å –¥—Ä—É–≥–∏–º–∏. –í–∞—à–∞ —Ö–∞—Ä–∏–∑–º–∞, –ª—ë–≥–∫–æ—Å—Ç—å –∏ –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å –¥–µ–ª–∞—é—Ç –≤–∞—Å —Ü–µ–Ω—Ç—Ä–æ–º –≤–Ω–∏–º–∞–Ω–∏—è.\n\nüîπ –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã\n‚Ä¢ –°–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å ‚Äî –≤—ã –∂–∏–≤—ë—Ç–µ ¬´–∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å¬ª, –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—é\n‚Ä¢ –≠–Ω—Ç—É–∑–∏–∞–∑–º ‚Äî –≤–∞—à–∞ —ç–Ω–µ—Ä–≥–∏—è –∑–∞—Ä—è–∂–∞–µ—Ç –æ–∫—Ä—É–∂–∞—é—â–∏—Ö\n‚Ä¢ –î—Ä—É–∂–µ–ª—é–±–∏–µ ‚Äî –≤—ã –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ –æ–±—â–∏–π —è–∑—ã–∫ —Å –ª—é–¥—å–º–∏\n\nüîπ –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚Ä¢ –•–∞—Ä–∏–∑–º–∞ –∏ –ª—ë–≥–∫–æ—Å—Ç—å –≤ –æ–±—â–µ–Ω–∏–∏\n‚Ä¢ –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∂–∏—Ç—å –º–æ–º–µ–Ω—Ç–æ–º –∏ —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è –∂–∏–∑–Ω–∏\n‚Ä¢ –≠–º–ø–∞—Ç–∏—è –∏ —É–º–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –¥—Ä—É–≥–∏—Ö\n‚Ä¢ –û–ø—Ç–∏–º–∏–∑–º –∏ —ç–Ω–µ—Ä–≥–∏—è`
    };
    
    return descriptions[type] || `üîπ –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n–í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî ${type}. –£–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ –æ —Å–≤–æ–∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è—Ö, –ø—Ä–æ–π–¥—è —Ç–µ—Å—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ü—Ä–æ—Ç–µ–π!`;
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ html2canvas
  const getOptimalCanvasSettings = () => {
    const devicePixelRatio = window.devicePixelRatio || 1;
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const isHighDPR = devicePixelRatio > 2; // –í—ã—Å–æ–∫–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –ø–∏–∫—Å–µ–ª–µ–π (Retina, 4K)
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–±
    let optimalScale = 2; // –ë–∞–∑–æ–≤—ã–π –º–∞—Å—à—Ç–∞–±
    
    if (isMobile) {
      if (isHighDPR) {
        optimalScale = Math.max(5, devicePixelRatio * 2); // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —Å –≤—ã—Å–æ–∫–∏–º DPR
      } else {
        optimalScale = Math.max(4, devicePixelRatio * 2); // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö
      }
    } else if (isHighDPR) {
      optimalScale = Math.max(3, devicePixelRatio * 1.5); // –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–æ–≤ —Å –≤—ã—Å–æ–∫–∏–º DPR
    } else {
      optimalScale = Math.max(2, devicePixelRatio); // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –¥–µ—Å–∫—Ç–æ–ø–æ–≤
    }
    
    console.log(`Canvas settings - Device pixel ratio: ${devicePixelRatio}, Optimal scale: ${optimalScale}, Is mobile: ${isMobile}, Is high DPR: ${isHighDPR}`);
    
    return { optimalScale, isMobile, devicePixelRatio, isHighDPR };
  };

  const createResultImage = async (testId: string, result: any) => {
    // –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    let tempContainer: HTMLDivElement | null = null;
    
    try {
      // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Ç–µ—Å—Ç–∞
      const resultElement = document.querySelector(`[data-test-result="${testId}"]`);
      if (!resultElement) {
        console.error('Result element not found');
        return null;
      }

      // –ü–æ–ª—É—á–∞–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      const { optimalScale, isMobile, devicePixelRatio, isHighDPR } = getOptimalCanvasSettings();

      // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
      tempContainer = document.createElement('div');
      tempContainer.style.position = 'absolute';
      tempContainer.style.left = '-9999px';
      tempContainer.style.top = '-9999px';
      tempContainer.style.width = 'auto';
      tempContainer.style.height = 'auto';
      tempContainer.style.overflow = 'visible';
      tempContainer.style.backgroundColor = '#ffffff';
      tempContainer.style.padding = '20px';
      tempContainer.style.borderRadius = '8px';
      tempContainer.style.boxShadow = 'none';
      
      // –ö–ª–æ–Ω–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      const clonedElement = resultElement.cloneNode(true) as HTMLElement;
      clonedElement.style.width = 'auto';
      clonedElement.style.height = 'auto';
      clonedElement.style.overflow = 'visible';
      clonedElement.style.position = 'relative';
      clonedElement.style.transform = 'none';
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
      tempContainer.appendChild(clonedElement);
      document.body.appendChild(tempContainer);
      
      // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
      await new Promise(resolve => setTimeout(resolve, 100));
      
      // –ü–æ–ª—É—á–∞–µ–º —Ç–æ—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
      const rect = clonedElement.getBoundingClientRect();
      const computedStyle = window.getComputedStyle(clonedElement);
      
      // –£—á–∏—Ç—ã–≤–∞–µ–º –≤—Å–µ –æ—Ç—Å—Ç—É–ø—ã –∏ –≥—Ä–∞–Ω–∏—Ü—ã
      const paddingTop = parseFloat(computedStyle.paddingTop) || 0;
      const paddingBottom = parseFloat(computedStyle.paddingBottom) || 0;
      const paddingLeft = parseFloat(computedStyle.paddingLeft) || 0;
      const paddingRight = parseFloat(computedStyle.paddingRight) || 0;
      const borderTop = parseFloat(computedStyle.borderTopWidth) || 0;
      const borderBottom = parseFloat(computedStyle.borderBottomWidth) || 0;
      const borderLeft = parseFloat(computedStyle.borderLeftWidth) || 0;
      const borderRight = parseFloat(computedStyle.borderRightWidth) || 0;
      
      // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–ª–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —Å —É—á–µ—Ç–æ–º –æ—Ç—Å—Ç—É–ø–æ–≤ –∏ –≥—Ä–∞–Ω–∏—Ü
      const fullWidth = rect.width + paddingLeft + paddingRight + borderLeft + borderRight;
      const fullHeight = rect.height + paddingTop + paddingBottom + borderTop + borderBottom;
      
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º layout –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
      clonedElement.offsetHeight; // Trigger reflow
      
      // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
      const extraPadding = 80; // 40px —Å–≤–µ—Ä—Ö—É –∏ —Å–Ω–∏–∑—É –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
      const finalWidth = Math.max(fullWidth, clonedElement.scrollWidth, clonedElement.offsetWidth) + extraPadding;
      const finalHeight = Math.max(fullHeight, clonedElement.scrollHeight, clonedElement.offsetHeight) + extraPadding;
      
      console.log(`Cloned element dimensions - Width: ${finalWidth}, Height: ${finalHeight}, Scroll: ${clonedElement.scrollWidth}x${clonedElement.scrollHeight}, Offset: ${clonedElement.offsetWidth}x${clonedElement.offsetHeight}, Rect: ${rect.width}x${rect.height}`);

      // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –∏–∑ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
      const canvas = await html2canvas(clonedElement, {
        backgroundColor: '#ffffff',
        scale: optimalScale, // –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–± –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        useCORS: true,
        allowTaint: true,
        logging: false,
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
        width: finalWidth,
        height: finalHeight,
        // –£–±–∏—Ä–∞–µ–º —Å–∫—Ä–æ–ª–ª–∏–Ω–≥ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        scrollX: 0,
        scrollY: 0,
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –æ–∫–Ω–∞ —Ä–∞–≤–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º —ç–ª–µ–º–µ–Ω—Ç–∞
        windowWidth: finalWidth,
        windowHeight: finalHeight,
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
        removeContainer: true,
        foreignObjectRendering: false,
        imageTimeout: 15000,
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª–∏–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        ignoreElements: (element) => {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –º–µ—à–∞—Ç—å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É
          const htmlElement = element as HTMLElement;
          return htmlElement.style.position === 'fixed' || 
                 htmlElement.style.position === 'sticky' ||
                 htmlElement.classList.contains('fixed') ||
                 htmlElement.classList.contains('sticky');
        },
        // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—ã—Å–æ–∫–æ–≥–æ DPR
        ...(isHighDPR && {
          scale: Math.max(optimalScale, devicePixelRatio * 2),
          imageTimeout: 20000, // –ë–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
        }),
        // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        ...(isMobile && {
          imageTimeout: 25000, // –ë–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
          removeContainer: true,
          foreignObjectRendering: false,
        })
      });

      // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º canvas –≤ blob —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º
      const blob = await new Promise<Blob>((resolve) => {
        canvas.toBlob((blob) => {
          if (blob) {
            resolve(blob);
          }
        }, 'image/png', 1.0); // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ PNG
      });
      
      // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
      if (tempContainer && tempContainer.parentNode) {
        tempContainer.parentNode.removeChild(tempContainer);
      }
      
      return blob;
    } catch (error) {
      console.error('Error creating image:', error);
      
      // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
      if (tempContainer && tempContainer.parentNode) {
        tempContainer.parentNode.removeChild(tempContainer);
      }
      
      return null;
    }
  };

  const handleShareResult = async (testId: string, result: any) => {
    try {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      const shareButton = document.querySelector(`[data-share-button="${testId}"]`);
      if (shareButton) {
        const originalText = shareButton.textContent;
        shareButton.textContent = 'üîÑ –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...';
        shareButton.setAttribute('disabled', 'true');
      }

      // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      const imageBlob = await createResultImage(testId, result);
      
      if (!imageBlob) {
        // Fallback –∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É —à–∞—Ä–∏–Ω–≥—É
        const shareText = generateShareText(testId, result);
        if (navigator.share) {
          await navigator.share({
            title: '–ú–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∞',
            text: shareText,
            url: window.location.href
          });
        } else {
          await navigator.clipboard.writeText(shareText);
          alert('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
        }
        return;
      }

      // –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
      const file = new File([imageBlob], `result-${testId}.png`, { type: 'image/png' });

      if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º Web Share API —Å —Ñ–∞–π–ª–æ–º
        await navigator.share({
          title: '–ú–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∞',
          text: '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –º–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!',
          files: [file]
        });
      } else {
        // Fallback: —Å–∫–∞—á–∏–≤–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É
        const url = URL.createObjectURL(imageBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `result-${testId}.png`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        alert('–ö–∞—Ä—Ç–∏–Ω–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Å–∫–∞—á–∞–Ω–∞!');
      }
    } catch (error) {
      console.error('Error sharing result:', error);
      // Fallback –∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É —à–∞—Ä–∏–Ω–≥—É
      const shareText = generateShareText(testId, result);
      if (navigator.share) {
        await navigator.share({
          title: '–ú–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∞',
          text: shareText,
          url: window.location.href
        });
      } else {
        await navigator.clipboard.writeText(shareText);
        alert('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
      }
    } finally {
      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
      const shareButton = document.querySelector(`[data-share-button="${testId}"]`);
      if (shareButton) {
        shareButton.textContent = 'üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è';
        shareButton.removeAttribute('disabled');
      }
    }
  };

  const getTestName = (testId: string): string => {
    switch (testId) {
      case 'mbti':
        return 'MBTI (–¢–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏)';
      case 'bigFive':
        return 'Big Five (–ü—è—Ç—å —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –ª–∏—á–Ω–æ—Å—Ç–∏)';
      case 'archetype':
        return '–ê—Ä—Ö–µ—Ç–∏–ø—ã –ª–∏—á–Ω–æ—Å—Ç–∏';
      case 'stress':
        return '–¢–µ—Å—Ç –Ω–∞ —Å—Ç—Ä–µ—Å—Å';
      default:
        return '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç';
    }
  };

  const formatResultForChat = (testId: string, result: any): string => {
    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    console.log(`Formatting result for test ${testId}:`, result);
    console.log(`Result type:`, typeof result);
    console.log(`Result is array:`, Array.isArray(result));
    
    try {
      switch (testId) {
        case 'mbti':
          if (typeof result === 'object' && result !== null && result.scores) {
            const scores = result.scores;
            const mbtiTitles: Record<string, string> = {
              'INTJ': '–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä', 'INTP': '–õ–æ–≥–∏–∫', 'ENTJ': '–ö–æ–º–∞–Ω–¥–∏—Ä', 'ENTP': '–ù–æ–≤–∞—Ç–æ—Ä',
              'INFJ': '–ê–¥–≤–æ–∫–∞—Ç', 'INFP': '–ü–æ—Å—Ä–µ–¥–Ω–∏–∫', 'ENFJ': '–ü—Ä–æ—Ç–∞–≥–æ–Ω–∏—Å—Ç', 'ENFP': '–ê–∫—Ç–∏–≤–∏—Å—Ç',
              'ISTJ': '–õ–æ–≥–∏—Å—Ç', 'ISFJ': '–ó–∞—â–∏—Ç–Ω–∏–∫', 'ESTJ': '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', 'ESFJ': '–ö–æ–Ω—Å—É–ª',
              'ISTP': '–í–∏—Ä—Ç—É–æ–∑', 'ISFP': '–ê–≤–∞–Ω—Ç—é—Ä–∏—Å—Ç', 'ESTP': '–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å', 'ESFP': '–†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å'
            };
            
            const title = mbtiTitles[result.type] || result.type;
            
            return `# üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ MBTI

## –¢–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏
**${title}** (${result.type})

## –ë–∞–ª–ª—ã –ø–æ —à–∫–∞–ª–∞–º
- **E-I** (–≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—è-–ò–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏—è): ${scores.E || 0} - ${scores.I || 0}
- **S-N** (–°–µ–Ω—Å–æ—Ä–∏–∫–∞-–ò–Ω—Ç—É–∏—Ü–∏—è): ${scores.S || 0} - ${scores.N || 0}
- **T-F** (–ú—ã—à–ª–µ–Ω–∏–µ-–ß—É–≤—Å—Ç–≤–æ): ${scores.T || 0} - ${scores.F || 0}
- **J-P** (–°—É–∂–¥–µ–Ω–∏–µ-–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ): ${scores.J || 0} - ${scores.P || 0}`;
          } else if (typeof result === 'string') {
            return `üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç MBTI:** ${result}`;
          } else {
            return `üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç MBTI:** ${JSON.stringify(result, null, 2)}`;
          }
          
        case 'bigFive':
          if (Array.isArray(result) && result.length > 0) {
            const factors = result.map(factor => {
              if (typeof factor === 'object' && factor !== null) {
                const factorNames: Record<string, string> = {
                  'openness': '–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –∫ –æ–ø—ã—Ç—É',
                  'conscientiousness': '–î–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ—Å—Ç—å',
                  'extraversion': '–≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—è',
                  'agreeableness': '–î–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å',
                  'neuroticism': '–ù–µ–π—Ä–æ—Ç–∏–∑–º'
                };
                
                const levelNames: Record<string, string> = {
                  'very_low': '–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π',
                  'low': '–ù–∏–∑–∫–∏–π',
                  'average': '–°—Ä–µ–¥–Ω–∏–π',
                  'high': '–í—ã—Å–æ–∫–∏–π',
                  'very_high': '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π'
                };
                
                const factorName = factorNames[factor.factor] || factor.factor;
                const levelName = levelNames[factor.level] || factor.level;
                
                return `‚Ä¢ **${factorName}:** ${factor.score || 0}/100 (${levelName})`;
              } else {
                return `‚Ä¢ **–§–∞–∫—Ç–æ—Ä:** ${factor}`;
              }
            }).join('\n');
            
            return `# üß† –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ Big Five

## –ü—è—Ç—å —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –ª–∏—á–Ω–æ—Å—Ç–∏

${factors}`;
          } else if (typeof result === 'string') {
            return `üß† **–†–µ–∑—É–ª—å—Ç–∞—Ç Big Five:** ${result}`;
          } else {
            return `üß† **–†–µ–∑—É–ª—å—Ç–∞—Ç Big Five:** ${JSON.stringify(result, null, 2)}`;
          }
          
        case 'archetype':
          if (Array.isArray(result) && result.length > 0) {
            const archetypeNames: Record<string, string> = {
              'innocent': '–ù–µ–≤–∏–Ω–Ω—ã–π',
              'everyman': '–û–±—ã–≤–∞—Ç–µ–ª—å',
              'hero': '–ì–µ—Ä–æ–π',
              'caregiver': '–ó–∞–±–æ—Ç–ª–∏–≤—ã–π',
              'explorer': '–ò—Å–∫–∞—Ç–µ–ª—å',
              'rebel': '–ë—É–Ω—Ç–∞—Ä—å',
              'lover': '–õ—é–±–æ–≤–Ω–∏–∫',
              'creator': '–¢–≤–æ—Ä–µ—Ü',
              'jester': '–®—É—Ç',
              'sage': '–ú—É–¥—Ä–µ—Ü',
              'magician': '–ú–∞–≥',
              'ruler': '–ü—Ä–∞–≤–∏—Ç–µ–ª—å'
            };
            
            const levelNames: Record<string, string> = {
              'weak': '–°–ª–∞–±—ã–π',
              'moderate': '–£–º–µ—Ä–µ–Ω–Ω—ã–π',
              'strong': '–°–∏–ª—å–Ω—ã–π',
              'very_strong': '–û—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π'
            };
            
            const topArchetypes = result.slice(0, 3).map((archetype, index) => {
              if (typeof archetype === 'object' && archetype !== null) {
                const archetypeName = archetypeNames[archetype.archetype] || archetype.archetype;
                const levelName = levelNames[archetype.level] || archetype.level;
                const score = archetype.score || 0;
                
                return `${index + 1}. **${archetypeName}** - ${levelName} (${score} –±–∞–ª–ª–æ–≤)`;
              } else {
                return `${index + 1}. **–ê—Ä—Ö–µ—Ç–∏–ø:** ${archetype}`;
              }
            }).join('\n');
            
            return `# üëë –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ –Ω–∞ –∞—Ä—Ö–µ—Ç–∏–ø—ã

## –ú–æ–∏ –≤–µ–¥—É—â–∏–µ –∞—Ä—Ö–µ—Ç–∏–ø—ã

${topArchetypes}`;
          } else if (typeof result === 'string') {
            return `üëë **–†–µ–∑—É–ª—å—Ç–∞—Ç –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤:** ${result}`;
          } else {
            return `üëë **–†–µ–∑—É–ª—å—Ç–∞—Ç –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤:** ${JSON.stringify(result, null, 2)}`;
          }
          
        case 'stress':
          if (typeof result === 'object' && result !== null && result.level) {
            const levelNames: Record<string, string> = {
              'low': '–ù–∏–∑–∫–∏–π',
              'moderate': '–£–º–µ—Ä–µ–Ω–Ω—ã–π',
              'high': '–í—ã—Å–æ–∫–∏–π',
              'very_high': '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π'
            };
            
            const levelName = levelNames[result.level] || result.level;
            const score = result.score || 0;
            const percentage = result.percentage || 0;
            const description = result.description || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
            const recommendations = result.recommendations || '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã';
            
            return `# üò∞ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–µ—Å—Å

## –£—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞
**${levelName}**

## –ë–∞–ª–ª—ã
**${score}/160** (${percentage}%)

## üìã –û–ø–∏—Å–∞–Ω–∏–µ
${description}

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
${recommendations}`;
          } else if (typeof result === 'string') {
            return `üò∞ **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–µ—Å—Å:** ${result}`;
          } else {
            return `üò∞ **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–µ—Å—Å:** ${JSON.stringify(result, null, 2)}`;
          }
          
        default:
          if (typeof result === 'string') {
            return `üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞:** ${result}`;
          } else if (typeof result === 'object' && result !== null) {
            return `üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞:** ${JSON.stringify(result, null, 2)}`;
          } else {
            return `üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞:** ${String(result)}`;
          }
      }
    } catch (error) {
      console.error(`Error formatting result for test ${testId}:`, error);
      return `‚ùå **–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ç–µ—Å—Ç–∞ ${testId}**\n\n–†–µ–∑—É–ª—å—Ç–∞—Ç: ${JSON.stringify(result, null, 2)}`;
    }
  };

  const handleTalkToProteus = async (testId: string, result: any) => {
    try {
      // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
      console.log(`Preparing chat message for test ${testId}:`, result);
      console.log(`Result type:`, typeof result);
      console.log(`Result structure:`, result);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ undefined –∏–ª–∏ null
      if (result === undefined || result === null) {
        console.error(`Result for test ${testId} is undefined or null`);
        alert('–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ.');
        return;
      }
      
      // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Ç–µ—Å—Ç–∞
      const testName = getTestName(testId);
      const resultText = formatResultForChat(testId, result);
      
      console.log(`Formatted result text:`, resultText);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –ø—É—Å—Ç–æ–π
      if (!resultText || resultText.trim() === '') {
        console.error(`Formatted result text is empty for test ${testId}`);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
        return;
      }
      
      // –°–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ü—Ä–æ—Ç–µ—è
      const fullMessage = `–ü—Ä–∏–≤–µ—Ç, –ü—Ä–æ—Ç–µ–π! –Ø —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø—Ä–æ—à–µ–ª —Ç–µ—Å—Ç "${testName}" –∏ —Ö–æ—á—É –æ–±—Å—É–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –í–æ—Ç —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å:\n\n${resultText}\n\n–ú–æ–∂–µ—à—å –ø–æ–º–æ—á—å –º–Ω–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –∏ –¥–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏?`;
      
      console.log(`Full message for Proteus:`, fullMessage);
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ localStorage –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ —á–∞—Ç
      localStorage.setItem('proteusChatMessage', fullMessage);
      localStorage.setItem('proteusChatSource', 'psychology-test');
      localStorage.setItem('proteusChatTestId', testId);
      
      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–∞—Ç–∞
      navigate('/chat');
      
    } catch (error) {
      console.error('Error preparing chat message:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —á–∞—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
    }
  };

  return (
    <motion.div
      variants={pageAnimation}
      initial="initial"
      animate="animate"
      exit="exit"
      transition={{ duration: 0.4 }}
      className="space-y-8 max-w-4xl mx-auto"
    >
      <div className="text-center">
        <h1 className="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-purple-600">
          –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
        </h1>
        <p className="text-muted-foreground mt-2 mb-6">
          –ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å–≤–æ–µ–π –ª–∏—á–Ω–æ—Å—Ç–∏
        </p>
        
        {/* –í–∞–∂–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ */}
        <motion.div
          variants={cardAnimation}
          initial="initial"
          animate="animate"
          className="bg-white/80 backdrop-blur-sm border border-gray-200/60 rounded-2xl p-6 max-w-4xl mx-auto shadow-xl shadow-gray-200/50 dark:bg-gray-800/80 dark:border-gray-700/60 dark:shadow-gray-900/50"
        >
          <div className="flex items-start space-x-4">
            <div className="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
              <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <div className="flex-1">
              <h3 className="font-semibold text-gray-900 dark:text-white text-lg mb-3">
                –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
              </h3>
              <p className="text-gray-600 dark:text-gray-300 leading-relaxed text-base">
                –¢–µ—Å—Ç—ã –ø–æ–º–æ–≥–∞—é—Ç –ª—É—á—à–µ —É–∑–Ω–∞—Ç—å —Å–µ–±—è –∏ –∑–∞–¥—É–º–∞—Ç—å—Å—è –æ —Å–≤–æ–∏—Ö –ø—Ä–∏–≤—ã—á–∫–∞—Ö, —ç–º–æ—Ü–∏—è—Ö –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–∏. 
                –ù–æ –ø–æ–º–Ω–∏—Ç–µ: —ç—Ç–æ –Ω–µ –¥–∏–∞–≥–Ω–æ–∑, –∞ –ª–∏—à—å –ø–æ–¥—Å–∫–∞–∑–∫–∞. –¢–æ–ª—å–∫–æ –ø—Å–∏—Ö–æ–ª–æ–≥ –∏–ª–∏ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç –º–æ–∂–µ—Ç 
                –¥–∞—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞—Å —Ç—Ä–µ–≤–æ–∂–∞—Ç –∏–ª–∏ 
                –≤—ã–∑—ã–≤–∞—é—Ç –≤–æ–ø—Ä–æ—Å—ã, –ª—É—á—à–µ –æ–±—Å—É–¥–∏—Ç—å –∏—Ö —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º.
              </p>
            </div>
          </div>
        </motion.div>
      </div>

      <div className="space-y-6">
        {tests.map((test, index) => {
          const status = getStatus(test.id);
          return (
            <motion.div
              key={test.id}
              variants={cardAnimation}
              initial="initial"
              animate="animate"
              transition={{ duration: 0.5, delay: index * 0.1 }}
              whileHover={cardHover}
            >
              <div className="border rounded-xl overflow-hidden">
                <Accordion 
                  type="single" 
                  collapsible
                >
                  <AccordionItem value={test.id} className="border-b-0">
                    <AccordionTrigger 
                      className="hover:no-underline px-6 py-4"
                    >
                      <div className="flex items-center justify-between w-full">
                        <div className="flex items-center space-x-4">
                          <test.icon className={`h-6 w-6 ${test.color}`} />
                          <div className="text-left">
                            <h3 className="text-lg font-semibold">{test.title}</h3>
                            <p className="text-sm text-muted-foreground">{test.description}</p>
                          </div>
                        </div>
                        <div className="flex items-center space-x-2">
                          <div className={`flex items-center text-xs font-medium px-2 py-1 rounded-full ${status.className}`}>
                            <span className="mr-1.5">{status.icon}</span>
                            <span>{status.text}</span>
                          </div>
                          <span className="text-xs text-muted-foreground">{status.time}</span>
                        </div>
                      </div>
                    </AccordionTrigger>
                    <AccordionContent className="px-6 pb-6 pt-2 space-y-4">
                      <div className="relative bg-muted/40 dark:bg-muted/10 border border-border/60 rounded-xl p-5">
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-muted-foreground/40 to-transparent rounded-t-xl" />
                        <h4 className="text-base font-semibold mb-2">–û —Ç–µ—Å—Ç–µ</h4>
                        <p className="text-sm text-muted-foreground">{(test as any).longDescription || test.description}. –ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç, –æ—Ç–≤–µ—á–∞—è –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ ‚Äî —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Ç–æ—á–Ω–µ–µ –æ—Ç—Ä–∞–∑–∏—Ç—å –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å.</p>
                      </div>

                      {activeTest === test.id ? (
                        <test.component 
                          onComplete={(result: any) => handleTestComplete(test.id, result)}
                        />
                      ) : testResults[test.id] ? (
                        <div className="relative bg-gradient-to-br from-primary/5 to-purple-500/5 dark:from-primary/10 dark:to-purple-900/10 border border-border/60 rounded-xl p-5">
                          <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary via-purple-500 to-pink-500 rounded-t-xl" />
                          <h4 className="text-lg font-semibold mb-3">–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h4>
                          <div data-test-result={test.id}>
                            {test.id === 'mbti' ? (
                              (() => {
                                const result = testResults[test.id];
                                if (typeof result === 'object' && result !== null && 'type' in result) {
                                  // –£ –Ω–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –æ—Ü–µ–Ω–∫–∞–º–∏
                                  return (
                                    <MBTITest onComplete={() => {}} forceResult={{ type: result.type, scores: result.scores }} />
                                  );
                                } else if (typeof result === 'string') {
                                  // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç - –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–∏–ø –∏–∑ —Å—Ç—Ä–æ–∫–∏
                                  const match = result.match(/\((E|I)(S|N)(T|F)(J|P)\)/);
                                  const typeFromTitle = match ? match[0].replace(/[()]/g, '') : undefined;
                                  return (
                                    <MBTITest onComplete={() => {}} forceResult={{ type: typeFromTitle || '' }} />
                                  );
                                }
                                return null;
                              })()
                            ) : test.id === 'big-five' ? (
                              (() => {
                                const result = testResults[test.id];
                                if (typeof result === 'object' && Array.isArray(result)) {
                                  // –£ –Ω–∞—Å –µ—Å—Ç—å –º–∞—Å—Å–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∞ Big Five
                                  return (
                                    <div className="space-y-6">
                                      <div className="text-center">
                                        <h2 className="text-2xl font-bold text-[#000126] mb-4">
                                          üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ Big Five
                                        </h2>
                                        <p className="text-muted-foreground">
                                          –í–∞—à–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –ø—è—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ã–º —Ñ–∞–∫—Ç–æ—Ä–∞–º –ª–∏—á–Ω–æ—Å—Ç–∏
                                        </p>
                                      </div>

                                      <div className="grid gap-6">
                                        {result.map((factorResult: any, index: number) => (
                                          <Card key={index} className="p-6">
                                            <div className="flex items-center justify-between mb-4">
                                              <div className="flex items-center space-x-3">
                                                <h3 className="text-xl font-semibold capitalize">
                                                  {factorResult.factor === 'openness' ? '–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –æ–ø—ã—Ç—É' :
                                                   factorResult.factor === 'conscientiousness' ? '–î–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ—Å—Ç—å' :
                                                   factorResult.factor === 'extraversion' ? '–≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—è' :
                                                   factorResult.factor === 'agreeableness' ? '–î–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å' :
                                                   factorResult.factor === 'neuroticism' ? '–ù–µ–π—Ä–æ—Ç–∏–∑–º' : factorResult.factor}
                                                </h3>
                                                <div className={`px-3 py-1 rounded-full text-sm font-bold shadow-lg ${
                                                  factorResult.level === 'very_low' ? 'bg-red-500 text-white' :
                                                  factorResult.level === 'low' ? 'bg-orange-500 text-white' :
                                                  factorResult.level === 'average' ? 'bg-yellow-500 text-gray-800' :
                                                  factorResult.level === 'high' ? 'bg-green-500 text-white' :
                                                  'bg-blue-600 text-white'
                                                }`}>
                                                  {factorResult.level === 'very_low' ? '–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π' :
                                                   factorResult.level === 'low' ? '–ù–∏–∑–∫–∏–π' :
                                                   factorResult.level === 'average' ? '–°—Ä–µ–¥–Ω–∏–π' :
                                                   factorResult.level === 'high' ? '–í—ã—Å–æ–∫–∏–π' :
                                                   '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π'}
                                                </div>
                                              </div>
                                              <div className="text-right">
                                                <div className="text-2xl font-bold text-[#000126]">
                                                  {factorResult.score}/{factorResult.maxScore}
                                                </div>
                                                <div className="text-sm text-muted-foreground">
                                                  {factorResult.percentage}%
                                                </div>
                                              </div>
                                            </div>
                                            
                                            <Progress value={factorResult.percentage} className="mb-4" />
                                            
                                            <div className="space-y-4">
                                              <h4 className="font-medium text-sm">üìñ –í–∞—à–∞ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</h4>
                                              
                                              <div className="p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border-l-4 border-blue-500">
                                                <h5 className="font-semibold text-blue-800 dark:text-blue-300 mb-3">
                                                  üîπ {factorResult.factor === 'openness' ? '–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –æ–ø—ã—Ç—É' :
                                                       factorResult.factor === 'conscientiousness' ? '–î–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ—Å—Ç—å' :
                                                       factorResult.factor === 'extraversion' ? '–≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—è' :
                                                       factorResult.factor === 'agreeableness' ? '–î–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å' :
                                                       factorResult.factor === 'neuroticism' ? '–ù–µ–π—Ä–æ—Ç–∏–∑–º' : factorResult.factor}
                                                </h5>
                                                
                                                <div className="space-y-3">
                                                  <div>
                                                                                                      <div className="flex items-center space-x-2 mb-2">
                                                    <h6 className={`font-bold text-sm px-3 py-1 rounded-full ${
                                                      factorResult.level === 'very_low' ? 'bg-red-100 text-red-800 border border-red-300' :
                                                      factorResult.level === 'low' ? 'bg-orange-100 text-orange-800 border border-orange-300' :
                                                      factorResult.level === 'average' ? 'bg-yellow-100 text-yellow-800 border border-yellow-300' :
                                                      factorResult.level === 'high' ? 'bg-green-100 text-green-800 border border-green-300' :
                                                      'bg-blue-100 text-blue-800 border border-blue-300'
                                                    }`}>
                                                      {factorResult.level === 'very_low' ? '–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å' :
                                                       factorResult.level === 'low' ? '–ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å' :
                                                       factorResult.level === 'average' ? '–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å' :
                                                       factorResult.level === 'high' ? '–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å' :
                                                       '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å'}
                                                    </h6>
                                                    <div className={`w-3 h-3 rounded-full ${
                                                      factorResult.level === 'very_low' ? 'bg-red-500' :
                                                      factorResult.level === 'low' ? 'bg-orange-500' :
                                                      factorResult.level === 'average' ? 'bg-yellow-500' :
                                                      factorResult.level === 'high' ? 'bg-green-500' :
                                                      'bg-blue-600'
                                                    }`}></div>
                                                  </div>
                                                    <p className="text-blue-600 dark:text-blue-300 text-sm leading-relaxed">
                                                      {factorResult.level === 'very_low' || factorResult.level === 'low' 
                                                        ? getBigFiveLowLevelDescription(factorResult.factor)
                                                        : factorResult.level === 'average'
                                                        ? getBigFiveMediumLevelDescription(factorResult.factor)
                                                        : getBigFiveHighLevelDescription(factorResult.factor)}
                                                    </p>
                                                  </div>
                                                </div>
                                              </div>
                                              
                                              <div className="space-y-2">
                                                <h4 className="font-medium text-sm">–•–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–µ —á–µ—Ä—Ç—ã:</h4>
                                                <div className="flex flex-wrap gap-2">
                                                  {factorResult.traits.map((trait: string, traitIndex: number) => (
                                                    <Badge key={traitIndex} variant="secondary" className="text-xs">
                                                      {trait}
                                                    </Badge>
                                                  ))}
                                                </div>
                                              </div>
                                            </div>
                                          </Card>
                                        ))}
                                      </div>
                                    </div>
                                  );
                                } else {
                                  // Fallback –∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é
                                  return (
                                    <div 
                                      className="prose prose-sm max-w-none dark:prose-invert text-foreground"
                                      dangerouslySetInnerHTML={{
                                        __html: (testResults[test.id] as string)
                                          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                                          .replace(/\n/g, '<br/>')
                                      }}
                                    />
                                  );
                                }
                              })()

                            ) : test.id === 'archetypes' ? (
                              (() => {
                                const result = testResults[test.id];
                                if (typeof result === 'object' && Array.isArray(result)) {
                                  // –£ –Ω–∞—Å –µ—Å—Ç—å –º–∞—Å—Å–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∞ –Ω–∞ –∞—Ä—Ö–µ—Ç–∏–ø—ã
                                  const sortedResults = [...result].sort((a: any, b: any) => b.score - a.score);
                                  const topArchetypes = sortedResults.slice(0, 3);
                                  
                                  return (
                                    <div className="space-y-4">
                                      <div className="text-center mb-4">
                                        <h4 className="text-lg font-semibold mb-2">üèÜ –í–∞—à–∏ –≤–µ–¥—É—â–∏–µ –∞—Ä—Ö–µ—Ç–∏–ø—ã</h4>
                                        <p className="text-sm text-muted-foreground">
                                          üí° –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π –∞—Ä—Ö–µ—Ç–∏–ø, —á—Ç–æ–±—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
                                        </p>
                                      </div>
                                      
                                      <div className="space-y-4">
                                        {topArchetypes.map((archetypeResult: any) => (
                                          <div key={archetypeResult.archetype} className="border rounded-lg overflow-hidden bg-card">
                                            <div 
                                              className="p-6 cursor-pointer hover:bg-muted/50 transition-colors"
                                              onClick={() => toggleArchetype(archetypeResult.archetype)}
                                            >
                                              <div className="flex items-center justify-between">
                                                <div className="flex items-center space-x-4">
                                                  <div className="w-12 h-12 bg-[#000126] rounded-full flex items-center justify-center text-white text-2xl">
                                                    {archetypeResult.archetype === 'innocent' ? 'üåø' :
                                                     archetypeResult.archetype === 'everyman' ? 'üë•' :
                                                     archetypeResult.archetype === 'hero' ? '‚öîÔ∏è' :
                                                     archetypeResult.archetype === 'caregiver' ? 'üíù' :
                                                     archetypeResult.archetype === 'explorer' ? 'üó∫Ô∏è' :
                                                     archetypeResult.archetype === 'rebel' ? 'üî•' :
                                                     archetypeResult.archetype === 'lover' ? 'üíï' :
                                                     archetypeResult.archetype === 'creator' ? 'üé®' :
                                                     archetypeResult.archetype === 'jester' ? 'üé≠' :
                                                     archetypeResult.archetype === 'sage' ? 'üßô' :
                                                     archetypeResult.archetype === 'magician' ? 'üîÆ' :
                                                     archetypeResult.archetype === 'ruler' ? 'üëë' : '‚ùì'}
                                                  </div>
                                                  <div className="text-left">
                                                    <h5 className="font-semibold text-lg capitalize">
                                                      {archetypeResult.archetype === 'innocent' ? '–ù–µ–≤–∏–Ω–Ω—ã–π' :
                                                       archetypeResult.archetype === 'everyman' ? '–°–∏—Ä–æ—Ç–∞/–û–±—ã–≤–∞—Ç–µ–ª—å' :
                                                       archetypeResult.archetype === 'hero' ? '–ì–µ—Ä–æ–π' :
                                                       archetypeResult.archetype === 'caregiver' ? '–ó–∞–±–æ—Ç–ª–∏–≤—ã–π' :
                                                       archetypeResult.archetype === 'explorer' ? '–ò—Å–∫–∞—Ç–µ–ª—å' :
                                                       archetypeResult.archetype === 'rebel' ? '–ë—É–Ω—Ç–∞—Ä—å' :
                                                       archetypeResult.archetype === 'lover' ? '–õ—é–±–æ–≤–Ω–∏–∫' :
                                                       archetypeResult.archetype === 'creator' ? '–¢–≤–æ—Ä–µ—Ü' :
                                                       archetypeResult.archetype === 'jester' ? '–®—É—Ç' :
                                                       archetypeResult.archetype === 'sage' ? '–ú—É–¥—Ä–µ—Ü' :
                                                       archetypeResult.archetype === 'magician' ? '–ú–∞–≥' :
                                                       archetypeResult.archetype === 'ruler' ? '–ü—Ä–∞–≤–∏—Ç–µ–ª—å' : archetypeResult.archetype}
                                                    </h5>
                                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                      archetypeResult.level === 'weak' ? 'bg-gray-100 text-gray-800' :
                                                      archetypeResult.level === 'moderate' ? 'bg-blue-100 text-blue-800' :
                                                      archetypeResult.level === 'strong' ? 'bg-green-100 text-green-800' :
                                                      'bg-purple-100 text-purple-800'
                                                    }`}>
                                                      {archetypeResult.level === 'weak' ? '–°–ª–∞–±–æ –≤—ã—Ä–∞–∂–µ–Ω' :
                                                       archetypeResult.level === 'moderate' ? '–£–º–µ—Ä–µ–Ω–Ω–æ –≤—ã—Ä–∞–∂–µ–Ω' :
                                                       archetypeResult.level === 'strong' ? '–°–∏–ª—å–Ω–æ –≤—ã—Ä–∞–∂–µ–Ω' :
                                                       '–û—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –≤—ã—Ä–∞–∂–µ–Ω'}
                                                    </span>
                                                  </div>
                                                </div>
                                                <div className="text-right">
                                                  <div className="text-2xl font-bold text-[#000126]">
                                                    {archetypeResult.score}/{archetypeResult.maxScore}
                                                  </div>
                                                  <div className="text-sm text-muted-foreground">
                                                    {archetypeResult.percentage}%
                                                  </div>
                                                  <div className="text-muted-foreground mt-1">
                                                    <svg 
                                                      className={`w-4 h-4 transition-transform duration-200 ${
                                                        expandedArchetypes.includes(archetypeResult.archetype) 
                                                          ? 'rotate-180' 
                                                          : ''
                                                      }`}
                                                      fill="none" 
                                                      stroke="currentColor" 
                                                      viewBox="0 0 24 24"
                                                    >
                                                      <path 
                                                        strokeLinecap="round" 
                                                        strokeLinejoin="round" 
                                                        strokeWidth={2} 
                                                        d="M19 9l-7 7-7-7" 
                                                      />
                                                    </svg>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                            
                                            {/* –†–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ */}
                                            {expandedArchetypes.includes(archetypeResult.archetype) && (
                                              <div className="border-t bg-muted/30 p-6 space-y-4">
                                              <div className="prose prose-sm max-w-none dark:prose-invert text-foreground">
                                                <div 
                                                  dangerouslySetInnerHTML={{
                                                    __html: archetypeResult.description.replace(/\n/g, '<br/>')
                                                  }}
                                                />
                                              </div>
                                              
                                              <div className="grid md:grid-cols-2 gap-4">
                                                <div>
                                                  <h6 className="font-medium mb-2">‚ú® –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã</h6>
                                                  <div className="flex flex-wrap gap-2">
                                                    {archetypeResult.strengths.map((strength: string, index: number) => (
                                                      <span key={index} className="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">
                                                        {strength}
                                                      </span>
                                                    ))}
                                                  </div>
                                                </div>
                                                
                                                <div>
                                                  <h6 className="font-medium mb-2">‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±–æ—Å—Ç–∏</h6>
                                                  <div className="flex flex-wrap gap-2">
                                                    {archetypeResult.weaknesses.map((weakness: string, index: number) => (
                                                      <span key={index} className="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full">
                                                        {weakness}
                                                      </span>
                                                    ))}
                                                  </div>
                                                </div>
                                              </div>
                                              
                                              <div className="grid md:grid-cols-2 gap-4">
                                                <div>
                                                  <h6 className="font-medium mb-2">üò® –ì–ª–∞–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ö–∏</h6>
                                                  <ul className="text-sm text-muted-foreground space-y-1">
                                                    {archetypeResult.fears.map((fear: string, index: number) => (
                                                      <li key={index}>‚Ä¢ {fear}</li>
                                                    ))}
                                                  </ul>
                                                </div>
                                                
                                                <div>
                                                  <h6 className="font-medium mb-2">üéØ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏</h6>
                                                  <ul className="text-sm text-muted-foreground space-y-1">
                                                    {archetypeResult.goals.map((goal: string, index: number) => (
                                                      <li key={index}>‚Ä¢ {goal}</li>
                                                    ))}
                                                  </ul>
                                                </div>
                                              </div>
                                              
                                              <div>
                                                <h6 className="font-medium mb-2">üë§ –ö–∞–∫ –≤–∞—Å –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç –¥—Ä—É–≥–∏–µ</h6>
                                                <p className="text-sm text-muted-foreground">
                                                  {archetypeResult.perception}
                                                </p>
                                              </div>
                                            </div>
                                            )}
                                          </div>
                                        ))}
                                      </div>
                                    </div>
                                  );
                                } else {
                                  // Fallback –∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é
                                  return (
                                    <div 
                                      className="prose prose-sm max-w-none dark:prose-invert text-foreground"
                                      dangerouslySetInnerHTML={{
                                        __html: (testResults[test.id] as string)
                                          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                                          .replace(/\n/g, '<br/>')
                                      }}
                                    />
                                  );
                                }
                              })()
                            ) : test.id === 'stress' ? (
                              (() => {
                                const result = testResults[test.id];
                                if (typeof result === 'object' && result !== null && 'level' in result) {
                                  // –£ –Ω–∞—Å –µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–µ—Å—Å
                                  const stressResult = result as StressResult;
                                  
                                  return (
                                    <div className="space-y-4">
                                      <div className="text-center mb-4">
                                        <h4 className="text-lg font-semibold mb-2">üß† –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–µ—Å—Å</h4>
                                      </div>
                                      
                                      {/* –û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç */}
                                      <div className="text-center space-y-4 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border-2 border-blue-200">
                                        <div className={`inline-flex items-center px-6 py-3 rounded-full text-xl font-bold shadow-lg ${
                                          stressResult.level === 'low' ? 'bg-green-500' :
                                          stressResult.level === 'moderate' ? 'bg-yellow-500' :
                                          stressResult.level === 'high' ? 'bg-orange-500' :
                                          'bg-red-500'
                                        } text-white`}>
                                          {stressResult.levelName}
                                        </div>
                                        
                                        <div className="text-2xl font-bold text-gray-800">
                                          {stressResult.score} / {stressResult.maxScore} –±–∞–ª–ª–æ–≤
                                        </div>
                                        
                                        <div className="text-lg text-gray-600">
                                          {stressResult.percentage}% –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
                                        </div>
                                        
                                        <Progress value={stressResult.percentage} className="h-3" />
                                      </div>

                                      {/* –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ */}
                                      <div className="bg-white rounded-lg p-6 border-l-4 border-blue-500 shadow-lg">
                                        <h3 className="text-xl font-semibold text-gray-800 mb-4">
                                          üìã –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è
                                        </h3>
                                        <div className="prose prose-lg max-w-none">
                                          <div 
                                            className="text-gray-700 leading-relaxed whitespace-pre-line"
                                            dangerouslySetInnerHTML={{ 
                                              __html: stressResult.description.replace(/\n/g, '<br/>') 
                                            }}
                                          />
                                        </div>
                                      </div>

                                      {/* –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ */}
                                      <div className="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-6 border-l-4 border-green-500 shadow-lg">
                                        <h3 className="text-xl font-semibold text-green-800 mb-4">
                                          üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                                        </h3>
                                        <p className="text-green-700 leading-relaxed">
                                          {stressResult.recommendations}
                                        </p>
                                      </div>
                                    </div>
                                  );
                                } else {
                                  // Fallback –∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é
                                  return (
                                    <div 
                                      className="prose prose-sm max-w-none dark:prose-invert text-foreground"
                                      dangerouslySetInnerHTML={{
                                        __html: (testResults[test.id] as string)
                                          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                                          .replace(/\n/g, '<br/>')
                                      }}
                                    />
                                  );
                                }
                              })()
                            ) : (
                            <div 
                              className="prose prose-sm max-w-none dark:prose-invert text-foreground"
                              dangerouslySetInnerHTML={{
                                __html: (testResults[test.id] as string)
                                  .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                                  .replace(/\n/g, '<br/>')
                              }}
                            />
                            )}
                          </div>
                          <div className="flex flex-col sm:flex-row gap-3 mt-4">
                            <Button 
                              variant="outline" 
                              onClick={() => handleStartTest(test.id)}
                              className="flex-1"
                            >
                              –ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ
                            </Button>
                            <Button 
                              variant="default" 
                              onClick={() => handleShareResult(test.id, testResults[test.id])}
                              data-share-button={test.id}
                              className="flex-1 bg-gradient-to-r from-primary to-purple-600 hover:from-primary/90 hover:to-purple-600/90 text-white shadow-lg"
                            >
                              <svg className="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
                              </svg>
                              –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                            </Button>
                            <Button 
                              variant="secondary" 
                              onClick={() => handleTalkToProteus(test.id, testResults[test.id])}
                              className="flex-1 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white shadow-lg"
                            >
                              <svg className="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z" />
                                <path d="M15 7v2a4 4 0 01-4 4H9l-1 1v-1H6a2 2 0 00-2 2v4a2 2 0 002 2h8a2 2 0 002-2V9a2 2 0 00-2-2z" />
                              </svg>
                              –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –ü—Ä–æ—Ç–µ–µ–º
                            </Button>
                          </div>
                        </div>
                      ) : (
                        <Button 
                          variant="outline"
                          onClick={() => handleStartTest(test.id)}
                        >
                          –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                        </Button>
                      )}
                    </AccordionContent>
                  </AccordionItem>
                </Accordion>
              </div>
            </motion.div>
          )
        })}
      </div>
    </motion.div>
  );
};

export default PsychologyPage;