export interface StressQuestion {
  id: number;
  category: string;
  text: string;
}

export interface StressResult {
  score: number;
  maxScore: number;
  percentage: number;
  level: 'low' | 'moderate' | 'high' | 'very_high';
  levelName: string;
  description: string;
  recommendations: string;
  color: string;
}

export interface StressTestConfig {
  title: string;
  description: string;
  questions: StressQuestion[];
  maxScore: number;
  results: {
    low: { min: number; max: number; name: string; color: string };
    moderate: { min: number; max: number; name: string; color: string };
    high: { min: number; max: number; name: string; color: string };
    very_high: { min: number; max: number; name: string; color: string };
  };
}

export const stressQuestions: StressQuestion[] = [
  // Эмоциональное состояние
  { id: 1, category: "Эмоциональное состояние", text: "Я часто чувствую тревогу без видимой причины." },
  { id: 2, category: "Эмоциональное состояние", text: "Мне сложно расслабиться даже в спокойной обстановке." },
  { id: 3, category: "Эмоциональное состояние", text: "Я легко раздражаюсь по мелочам." },
  { id: 4, category: "Эмоциональное состояние", text: "Я чувствую усталость даже после отдыха." },
  { id: 5, category: "Эмоциональное состояние", text: "У меня часто бывают перепады настроения." },
  { id: 6, category: "Эмоциональное состояние", text: "Я часто чувствую себя подавленным." },
  { id: 7, category: "Эмоциональное состояние", text: "Мне сложно радоваться тому, что раньше приносило удовольствие." },
  { id: 8, category: "Эмоциональное состояние", text: "Я чувствую себя перегруженным обязанностями." },
  { id: 9, category: "Эмоциональное состояние", text: "Я часто переживаю о будущем." },
  { id: 10, category: "Эмоциональное состояние", text: "Я чувствую себя одиноким или непонятым." },
  
  // Физические проявления
  { id: 11, category: "Физические проявления", text: "У меня часто болит голова." },
  { id: 12, category: "Физические проявления", text: "Я ощущаю напряжение в мышцах или спине." },
  { id: 13, category: "Физические проявления", text: "У меня бывают проблемы со сном (трудно заснуть или просыпаюсь ночью)." },
  { id: 14, category: "Физические проявления", text: "Я часто устаю быстрее обычного." },
  { id: 15, category: "Физические проявления", text: "У меня бывают проблемы с пищеварением (например, из-за нервов)." },
  { id: 16, category: "Физические проявления", text: "Я замечаю учащённое сердцебиение или потливость в стрессовых ситуациях." },
  { id: 17, category: "Физические проявления", text: "У меня снижен аппетит или, наоборот, я переедаю на фоне нервов." },
  { id: 18, category: "Физические проявления", text: "Я ощущаю слабость или головокружение." },
  { id: 19, category: "Физические проявления", text: "Я чаще болею простудными заболеваниями." },
  { id: 20, category: "Физические проявления", text: "У меня дрожат руки или голос в стрессовых ситуациях." },
  
  // Поведение и привычки
  { id: 21, category: "Поведение и привычки", text: "Я стал больше употреблять кофеина, алкоголя или сигарет." },
  { id: 22, category: "Поведение и привычки", text: "Я часто откладываю дела «на потом» из-за усталости." },
  { id: 23, category: "Поведение и привычки", text: "Мне трудно сосредоточиться на работе или учебе." },
  { id: 24, category: "Поведение и привычки", text: "Я стал больше времени проводить в телефоне/соцсетях, чтобы отвлечься." },
  { id: 25, category: "Поведение и привычки", text: "Я стал более замкнутым и реже общаюсь с друзьями." },
  { id: 26, category: "Поведение и привычки", text: "Я теряю интерес к хобби и увлечениям." },
  { id: 27, category: "Поведение и привычки", text: "Я чаще проявляю агрессию или резкость в общении." },
  { id: 28, category: "Поведение и привычки", text: "Я чувствую, что у меня нет контроля над ситуацией." },
  { id: 29, category: "Поведение и привычки", text: "Мне сложно планировать и доводить дела до конца." },
  { id: 30, category: "Поведение и привычки", text: "Я часто засыпаю с мыслями о нерешённых проблемах." },
  
  // Социальные и профессиональные аспекты
  { id: 31, category: "Социальные и профессиональные аспекты", text: "Я чувствую, что не справляюсь со своими обязанностями." },
  { id: 32, category: "Социальные и профессиональные аспекты", text: "Я часто конфликтую с коллегами, друзьями или родственниками." },
  { id: 33, category: "Социальные и профессиональные аспекты", text: "Я чувствую, что не получаю поддержки от близких." },
  { id: 34, category: "Социальные и профессиональные аспекты", text: "Я испытываю трудности в общении из-за раздражительности." },
  { id: 35, category: "Социальные и профессиональные аспекты", text: "Я часто ощущаю нехватку времени." },
  { id: 36, category: "Социальные и профессиональные аспекты", text: "Я ощущаю постоянное давление со стороны работы, учебы или семьи." },
  { id: 37, category: "Социальные и профессиональные аспекты", text: "Я не могу «отключиться» от работы/учёбы даже дома." },
  { id: 38, category: "Социальные и профессиональные аспекты", text: "Я чувствую, что мои достижения недооценивают." },
  { id: 39, category: "Социальные и профессиональные аспекты", text: "Я часто сравниваю себя с другими и испытываю чувство неполноценности." },
  { id: 40, category: "Социальные и профессиональные аспекты", text: "Я думаю, что мой уровень стресса превышает норму." }
];

export const stressTestConfig: StressTestConfig = {
  title: "Тест на определение уровня стресса",
  description: "Авторский тест из 40 вопросов для оценки уровня стресса и эмоционального состояния",
  questions: stressQuestions,
  maxScore: 160,
  results: {
    low: { min: 0, max: 40, name: "Низкий уровень стресса", color: "green" },
    moderate: { min: 41, max: 80, name: "Умеренный уровень стресса", color: "yellow" },
    high: { min: 81, max: 120, name: "Высокий уровень стресса", color: "orange" },
    very_high: { min: 121, max: 160, name: "Очень высокий уровень стресса", color: "red" }
  }
};

export function calculateStressResults(answers: Record<number, number>): StressResult {
  let totalScore = 0;
  
  // Подсчитываем общий балл
  for (let i = 1; i <= 40; i++) {
    totalScore += answers[i] || 0;
  }
  
  // Определяем уровень стресса
  let level: 'low' | 'moderate' | 'high' | 'very_high';
  let levelName: string;
  let description: string;
  let recommendations: string;
  let color: string;
  
  if (totalScore <= 40) {
    level = 'low';
    levelName = stressTestConfig.results.low.name;
    color = stressTestConfig.results.low.color;
    description = "Вы находитесь в состоянии относительного эмоционального и физического равновесия. Стрессовые ситуации встречаются, но вы умеете с ними справляться.\n\n• Ваш организм не перегружен напряжением.\n• Энергии хватает на работу, отдых и личные дела.\n• Эмоциональный фон в целом стабилен.";
    recommendations = "Продолжайте поддерживать баланс — полноценный сон, регулярная физическая активность, отдых и хобби. Это поможет сохранить устойчивость к стрессу в будущем.";
  } else if (totalScore <= 80) {
    level = 'moderate';
    levelName = stressTestConfig.results.moderate.name;
    color = stressTestConfig.results.moderate.color;
    description = "Стресс присутствует, но пока не разрушителен. Он может проявляться в виде усталости, раздражительности, снижения концентрации.\n\n• Вы можете ощущать тревожность или внутреннее напряжение.\n• Иногда сложно расслабиться и «отключиться» от дел.\n• Возможны нарушения сна или снижение работоспособности.";
    recommendations = "Важно внедрять методы саморегуляции — дыхательные практики, спорт, прогулки, сокращение времени в телефоне, общение с близкими. На этом этапе стресс ещё хорошо поддаётся контролю.";
  } else if (totalScore <= 120) {
    level = 'high';
    levelName = stressTestConfig.results.high.name;
    color = stressTestConfig.results.high.color;
    description = "Ваш организм уже серьёзно реагирует на нагрузку. Это может отражаться как на психическом, так и на физическом здоровье.\n\n• Часто ощущается усталость, апатия или раздражительность.\n• Возможны проблемы со сном, концентрацией внимания.\n• Учащаются головные боли, боли в мышцах, сбои в пищеварении.\n• Растёт риск конфликтов с окружающими и снижения продуктивности.";
    recommendations = "Стоит пересмотреть образ жизни и приоритеты. Полезно практиковать техники релаксации, научиться «выключаться» от работы, наладить режим сна. При длительном сохранении состояния лучше проконсультироваться с психологом.";
  } else {
    level = 'very_high';
    levelName = stressTestConfig.results.very_high.name;
    color = stressTestConfig.results.very_high.color;
    description = "Это критическая зона. Ваш организм работает «на износ», что может привести к эмоциональному выгоранию, депрессии и проблемам со здоровьем (гипертония, сердечно-сосудистые болезни, ослабленный иммунитет).\n\n• Энергии почти не остаётся.\n• Часто появляются чувство беспомощности, раздражительность или апатия.\n• Возможны частые болезни и психосоматические проявления.\n• Снижается способность к принятию решений и концентрации.";
    recommendations = "Очень важно срочно снизить нагрузку и заняться восстановлением. Стоит обратиться к специалисту (психолог, психотерапевт), наладить режим сна и питания, исключить лишние стимуляторы (алкоголь, кофеин), постепенно внедрять отдых и физическую активность.";
  }
  
  const percentage = Math.round((totalScore / stressTestConfig.maxScore) * 100);
  
  return {
    score: totalScore,
    maxScore: stressTestConfig.maxScore,
    percentage,
    level,
    levelName,
    description,
    recommendations,
    color
  };
}
